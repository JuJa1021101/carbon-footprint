{"version":3,"file":"reset-points.js","sources":["pages/admin/reset-points.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRtaW4vcmVzZXQtcG9pbnRzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-green px-4 py-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <image src=\"/static/images/icons/icon-back.svg\" class=\"back-icon\"></image>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-white text-lg font-medium\">积分系统重置</text>\n        </view>\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的占位 -->\n      </view>\n    </view>\n    \n    <!-- 内容区 -->\n    <view class=\"content-container\">\n      <view class=\"card\">\n        <view class=\"card-header\">\n          <text class=\"card-title\">积分系统重置</text>\n        </view>\n        <view class=\"card-body\">\n          <text class=\"warning-text\">警告：此操作将删除所有积分记录，并创建一个统一的默认用户积分记录。此操作不可逆，请谨慎操作！</text>\n          \n          <view class=\"info-box\">\n            <view class=\"info-item\">\n              <text class=\"info-label\">当前默认积分:</text>\n              <text class=\"info-value\">{{ currentPoints }}</text>\n            </view>\n            <view class=\"info-item\">\n              <text class=\"info-label\">默认用户ID:</text>\n              <text class=\"info-value\">10086420</text>\n            </view>\n            <view class=\"info-item\">\n              <text class=\"info-label\">重置后积分:</text>\n              <text class=\"info-value\">1000</text>\n            </view>\n          </view>\n          \n          <button class=\"reset-button\" @tap=\"confirmReset\" :disabled=\"isResetting\">\n            {{ isResetting ? '重置中...' : '重置积分系统' }}\n          </button>\n        </view>\n      </view>\n      \n      <view class=\"card mt-4\">\n        <view class=\"card-header\">\n          <text class=\"card-title\">刷新积分</text>\n        </view>\n        <view class=\"card-body\">\n          <text class=\"text-gray-600\">从云端获取最新积分数据</text>\n          <button class=\"refresh-button mt-3\" @tap=\"refreshPoints\" :disabled=\"isRefreshing\">\n            {{ isRefreshing ? '刷新中...' : '刷新积分' }}\n          </button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\n\nconst currentPoints = ref(0);\nconst isResetting = ref(false);\nconst isRefreshing = ref(false);\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 检查管理员登录状态\nonMounted(() => {\n  const adminLoginStatus = uni.getStorageSync('admin_login_status');\n  if (adminLoginStatus !== 'loggedin') {\n    uni.showToast({\n      title: '请先登录管理员账号',\n      icon: 'none'\n    });\n    setTimeout(() => {\n      uni.navigateTo({\n        url: '/pages/admin/login'\n      });\n    }, 1500);\n    return;\n  }\n  \n  // 加载当前积分\n  loadPoints();\n});\n\n// 加载当前积分\nconst loadPoints = async (force = false) => {\n  isRefreshing.value = true;\n  try {\n    // 使用固定的默认用户ID\n    const userId = '10086420';\n    \n    const { result } = await uniCloud.callFunction({\n      name: 'getUserPoints',\n      data: { userId }\n    });\n    \n    if (result && result.success) {\n      currentPoints.value = result.data.points;\n      console.log('当前积分:', currentPoints.value);\n    } else {\n      console.error('获取积分失败:', result);\n      uni.showToast({\n        title: '获取积分失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('获取积分失败:', error);\n    uni.showToast({\n      title: '获取积分失败',\n      icon: 'none'\n    });\n  } finally {\n    isRefreshing.value = false;\n  }\n};\n\n// 刷新积分\nconst refreshPoints = async () => {\n  await loadPoints(true);\n  \n  uni.showToast({\n    title: '积分已刷新',\n    icon: 'success'\n  });\n};\n\n// 确认重置\nconst confirmReset = () => {\n  uni.showModal({\n    title: '警告',\n    content: '此操作将删除所有积分记录，并创建一个新的默认积分记录。此操作不可逆，是否继续？',\n    success: (res) => {\n      if (res.confirm) {\n        resetPointsSystem();\n      }\n    }\n  });\n};\n\n// 重置积分系统\nconst resetPointsSystem = async () => {\n  isResetting.value = true;\n  \n  try {\n    uni.showLoading({ title: '重置中...' });\n    \n    const { result } = await uniCloud.callFunction({\n      name: 'resetPointsSystem'\n    });\n    \n    uni.hideLoading();\n    \n    if (result && result.success) {\n      uni.showToast({\n        title: '重置成功',\n        icon: 'success'\n      });\n      \n      // 刷新积分\n      await loadPoints(true);\n      \n      // 通知积分更新\n      uni.$emit('userPointsUpdated', { points: currentPoints.value });\n    } else {\n      uni.showToast({\n        title: '重置失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('重置积分系统失败:', error);\n    uni.hideLoading();\n    uni.showToast({\n      title: '重置失败',\n      icon: 'none'\n    });\n  } finally {\n    isResetting.value = false;\n  }\n};\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f8f9fa;\n}\n\n.header {\n  padding-top: 44px;\n  padding-bottom: 12px;\n  box-sizing: content-box;\n}\n\n.bg-green {\n  background-color: #4CAF50;\n}\n\n.w-24px {\n  width: 24px;\n}\n\n.content-container {\n  padding: 20px;\n}\n\n.card {\n  background-color: white;\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.card-header {\n  padding: 16px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.card-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: #333;\n}\n\n.card-body {\n  padding: 16px;\n}\n\n.warning-text {\n  color: #ef4444;\n  font-size: 14px;\n  line-height: 1.5;\n  margin-bottom: 16px;\n}\n\n.info-box {\n  background-color: #f8f9fa;\n  border-radius: 8px;\n  padding: 12px;\n  margin-bottom: 16px;\n}\n\n.info-item {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n\n.info-item:last-child {\n  margin-bottom: 0;\n}\n\n.info-label {\n  color: #666;\n  font-size: 14px;\n}\n\n.info-value {\n  color: #333;\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.reset-button {\n  width: 100%;\n  height: 44px;\n  line-height: 44px;\n  text-align: center;\n  background-color: #ef4444;\n  color: white;\n  border-radius: 8px;\n  font-size: 16px;\n  font-weight: 500;\n}\n\n.refresh-button {\n  width: 100%;\n  height: 44px;\n  line-height: 44px;\n  text-align: center;\n  background-color: #4CAF50;\n  color: white;\n  border-radius: 8px;\n  font-size: 16px;\n  font-weight: 500;\n}\n\n/* 工具类 */\n.text-white { color: #ffffff; }\n.text-gray-600 { color: #4b5563; }\n.text-lg { font-size: 18px; }\n.font-medium { font-weight: 500; }\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.text-center { text-align: center; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n.mt-3 { margin-top: 12px; }\n.mt-4 { margin-top: 16px; }\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/admin/reset-points.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onMounted","uniCloud","MiniProgramPage"],"mappings":"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"}