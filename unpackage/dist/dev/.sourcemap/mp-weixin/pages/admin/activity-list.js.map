{"version":3,"file":"activity-list.js","sources":["pages/admin/activity-list.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRtaW4vYWN0aXZpdHktbGlzdC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-green px-4 py-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <IconImage name=\"back\" :size=\"18\" class=\"back-icon\" />\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-white text-lg font-medium\">环保活动管理</text>\n        </view>\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的占位 -->\n      </view>\n    </view>\n    \n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"flex justify-center py-10\">\n      <image src=\"/static/images/loading.gif\" class=\"w-12 h-12\"></image>\n    </view>\n    \n    <!-- 内容区 -->\n    <view v-else class=\"p-4\">\n      <!-- 无活动提示 -->\n      <view v-if=\"activities.length === 0\" class=\"empty-container\">\n        <text class=\"empty-text\">暂无环保活动，点击\"添加\"按钮创建新活动</text>\n      </view>\n      \n      <!-- 活动列表 -->\n      <view v-else class=\"activity-list\">\n        <view \n          v-for=\"(activity, index) in activities\" \n          :key=\"activity._id\"\n          class=\"activity-item\"\n          @tap=\"navigateToEdit(activity._id)\">\n          <view class=\"activity-header\">\n            <text class=\"activity-title\">{{ activity.title }}</text>\n            <view class=\"more-btn\" @tap.stop=\"showDeleteOption(activity)\">\n              <IconImage name=\"more\" :size=\"16\" />\n            </view>\n          </view>\n          \n          <view class=\"activity-content\">\n            <text class=\"activity-desc\">{{ formatDescription(activity.description) }}</text>\n          </view>\n          \n          <view class=\"activity-footer\">\n            <view class=\"activity-info\">\n              <view class=\"info-item\">\n                <IconImage name=\"location\" :size=\"14\" class=\"mr-1\" />\n                <text class=\"info-text\">{{ activity.location }}</text>\n              </view>\n              <view class=\"info-item\">\n                <IconImage name=\"calendar\" :size=\"14\" class=\"mr-1\" />\n                <text class=\"info-text\">{{ activity.activity_time }}</text>\n              </view>\n            </view>\n            <view class=\"activity-status\" :class=\"getStatusClass(activity.status)\">\n              <text>{{ activity.status }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 悬浮添加按钮 -->\n    <view class=\"float-btn\" @tap=\"navigateToAdd\">\n      <view class=\"float-btn-inner\">\n        <text class=\"plus-text\">+</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport { getActivities, deleteActivity } from '../../services/activity.js';\nimport IconImage from '../../components/IconImage.vue';\n\n// 活动列表\nconst activities = ref([]);\nconst loading = ref(true);\n\n// 获取活动列表\nconst loadActivities = async () => {\n  loading.value = true;\n  try {\n    const result = await getActivities();\n    console.log('原始活动列表:', result.map(a => `${a.title} (${a.status})`));\n    \n    // 按状态排序：未开始 > 报名中 > 已结束\n    const sortedActivities = result.sort((a, b) => {\n      const statusOrder = {\n        '未开始': 1,\n        '报名中': 2,\n        '已结束': 3\n      };\n      \n      const statusA = statusOrder[a.status] || 999;\n      const statusB = statusOrder[b.status] || 999;\n      \n      return statusA - statusB;\n    });\n    \n    console.log('排序后活动列表:', sortedActivities.map(a => `${a.title} (${a.status})`));\n    activities.value = sortedActivities;\n  } catch (error) {\n    console.error('获取活动列表失败:', error);\n    uni.showToast({\n      title: error.message || '获取活动列表失败',\n      icon: 'none'\n    });\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 格式化描述文本（截取前50个字符）\nconst formatDescription = (description) => {\n  if (!description) return '';\n  if (description.length <= 50) return description;\n  return description.substring(0, 50) + '...';\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 跳转到添加活动页面\nconst navigateToAdd = () => {\n  uni.navigateTo({\n    url: '/pages/admin/activity-add'\n  });\n};\n\n// 跳转到编辑活动页面\nconst navigateToEdit = (activityId) => {\n  uni.navigateTo({\n    url: `/pages/admin/activity-edit?id=${activityId}`\n  });\n};\n\n// 显示删除选项\nconst showDeleteOption = (activity) => {\n  uni.showActionSheet({\n    itemList: ['删除'],\n    itemColor: '#ff0000',\n    success: (res) => {\n      if (res.tapIndex === 0) {\n        confirmDeleteActivity(activity);\n      }\n    }\n  });\n};\n\n// 确认删除活动\nconst confirmDeleteActivity = (activity) => {\n  uni.showModal({\n    title: '确认删除',\n    content: `确定要删除\"${activity.title}\"活动吗？删除后无法恢复。`,\n    confirmColor: '#ff0000',\n    success: (res) => {\n      if (res.confirm) {\n        handleDeleteActivity(activity._id);\n      }\n    }\n  });\n};\n\n// 删除活动\nconst handleDeleteActivity = async (activityId) => {\n  try {\n    await deleteActivity(activityId);\n    activities.value = activities.value.filter(activity => activity._id !== activityId);\n    uni.showToast({\n      title: '删除成功',\n      icon: 'success'\n    });\n  } catch (error) {\n    uni.showToast({\n      title: error.message || '删除失败',\n      icon: 'none'\n    });\n  }\n};\n\n// 获取状态样式类\nconst getStatusClass = (status) => {\n  switch (status) {\n    case '报名中':\n      return 'status-enrolling';\n    case '未开始':\n      return 'status-not-started';\n    case '已结束':\n      return 'status-ended';\n    default:\n      return '';\n  }\n};\n\n// 获取参与人数\nconst getParticipantsCount = (activity) => {\n  return activity.enrollCount || 0;\n};\n\n// 初始化加载活动列表\nonMounted(() => {\n  // 检查管理员登录状态\n  const adminLoginStatus = uni.getStorageSync('admin_login_status');\n  if (adminLoginStatus !== 'loggedin') {\n    uni.showToast({\n      title: '请先登录',\n      icon: 'none'\n    });\n    setTimeout(() => {\n      uni.navigateTo({\n        url: '/pages/admin/login'\n      });\n    }, 1500);\n    return;\n  }\n  \n  loadActivities();\n});\n\n// 每次显示页面时刷新活动列表\nonShow(() => {\n  const adminLoginStatus = uni.getStorageSync('admin_login_status');\n  if (adminLoginStatus === 'loggedin') {\n    loadActivities();\n  }\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f8f9fa;\n}\n\n.header {\n  padding-top: 44px;\n  padding-bottom: 12px;\n  box-sizing: content-box;\n}\n\n.bg-green {\n  background-color: #4CAF50;\n}\n\n.add-button {\n  position: fixed;\n  right: 30rpx;\n  bottom: 50rpx;\n  width: 100rpx;\n  height: 100rpx;\n  border-radius: 50%;\n  background-color: #4CD964;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  box-shadow: 0 4rpx 10rpx rgba(76, 217, 100, 0.3);\n  color: white;\n  font-size: 40rpx;\n  z-index: 100;\n}\n\n.empty-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 200px;\n}\n\n.empty-text {\n  color: #999;\n  font-size: 14px;\n}\n\n.activity-list {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.activity-item {\n  background-color: #fff;\n  border-radius: 12px;\n  padding: 16px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.activity-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.activity-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #333;\n}\n\n.more-btn {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.activity-content {\n  margin-bottom: 12px;\n}\n\n.activity-desc {\n  font-size: 14px;\n  color: #666;\n  line-height: 1.5;\n}\n\n.activity-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.activity-info {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.info-item {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.info-text {\n  font-size: 12px;\n  color: #666;\n}\n\n.activity-status {\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 12px;\n}\n\n.status-enrolling {\n  background-color: #e8f5e9;\n  color: #4CAF50;\n}\n\n.status-not-started {\n  background-color: #e3f2fd;\n  color: #2196F3;\n}\n\n.status-ended {\n  background-color: #eeeeee;\n  color: #757575;\n}\n\n/* 工具类 */\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n.text-center { text-align: center; }\n.text-white { color: #ffffff; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-600 { color: #4b5563; }\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.font-medium { font-weight: 500; }\n.bg-green-600 { background-color: #3d9140; }\n.rounded-full { border-radius: 9999px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-1 { padding-top: 4px; padding-bottom: 4px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n.py-10 { padding-top: 40px; padding-bottom: 40px; }\n.p-4 { padding: 16px; }\n.w-12 { width: 48px; }\n.h-12 { height: 48px; }\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n\n.float-btn {\n  position: fixed;\n  bottom: 80px;\n  right: 20px;\n  width: 50px;\n  height: 50px;\n  z-index: 100;\n}\n\n.float-btn-inner {\n  width: 50px;\n  height: 50px;\n  border-radius: 25px;\n  background-color: #4CAF50;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-size: 24px;\n}\n\n.plus-text {\n  color: white;\n  font-size: 30px;\n  font-weight: bold;\n  line-height: 30px;\n  text-align: center;\n  margin-top: -2px; /* 轻微上移调整垂直位置 */\n}\n\n.icon-size {\n  width: 16px;\n  height: 16px;\n}\n\n.info-icon {\n  width: 14px;\n  height: 14px;\n  margin-right: 4px;\n}\n\n.mr-1 {\n  margin-right: 4px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/admin/activity-list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getActivities","uni","deleteActivity","onMounted","onShow","MiniProgramPage"],"mappings":";;;;;;;AA6EA,MAAM,YAAY,MAAW;;;;AAG7B,UAAM,aAAaA,cAAAA,IAAI,CAAA,CAAE;AACzB,UAAM,UAAUA,cAAAA,IAAI,IAAI;AAGxB,UAAM,iBAAiB,YAAY;AACjC,cAAQ,QAAQ;AAChB,UAAI;AACF,cAAM,SAAS,MAAMC,kBAAAA;AACrBC,sBAAY,MAAA,MAAA,OAAA,uCAAA,WAAW,OAAO,IAAI,OAAK,GAAG,EAAE,KAAK,KAAK,EAAE,MAAM,GAAG,CAAC;AAGlE,cAAM,mBAAmB,OAAO,KAAK,CAAC,GAAG,MAAM;AAC7C,gBAAM,cAAc;AAAA,YAClB,OAAO;AAAA,YACP,OAAO;AAAA,YACP,OAAO;AAAA,UACf;AAEM,gBAAM,UAAU,YAAY,EAAE,MAAM,KAAK;AACzC,gBAAM,UAAU,YAAY,EAAE,MAAM,KAAK;AAEzC,iBAAO,UAAU;AAAA,QACvB,CAAK;AAEDA,sBAAA,MAAA,MAAA,OAAA,wCAAY,YAAY,iBAAiB,IAAI,OAAK,GAAG,EAAE,KAAK,KAAK,EAAE,MAAM,GAAG,CAAC;AAC7E,mBAAW,QAAQ;AAAA,MACpB,SAAQ,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,wCAAc,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,MAAM,WAAW;AAAA,UACxB,MAAM;AAAA,QACZ,CAAK;AAAA,MACL,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,oBAAoB,CAAC,gBAAgB;AACzC,UAAI,CAAC;AAAa,eAAO;AACzB,UAAI,YAAY,UAAU;AAAI,eAAO;AACrC,aAAO,YAAY,UAAU,GAAG,EAAE,IAAI;AAAA,IACxC;AAGA,UAAM,SAAS,MAAM;AACnBA,oBAAG,MAAC,aAAY;AAAA,IAClB;AAGA,UAAM,gBAAgB,MAAM;AAC1BA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;AAGA,UAAM,iBAAiB,CAAC,eAAe;AACrCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,iCAAiC,UAAU;AAAA,MACpD,CAAG;AAAA,IACH;AAGA,UAAM,mBAAmB,CAAC,aAAa;AACrCA,oBAAAA,MAAI,gBAAgB;AAAA,QAClB,UAAU,CAAC,IAAI;AAAA,QACf,WAAW;AAAA,QACX,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,aAAa,GAAG;AACtB,kCAAsB,QAAQ;AAAA,UAC/B;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,wBAAwB,CAAC,aAAa;AAC1CA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,SAAS,SAAS,KAAK;AAAA,QAChC,cAAc;AAAA,QACd,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACf,iCAAqB,SAAS,GAAG;AAAA,UAClC;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,uBAAuB,OAAO,eAAe;AACjD,UAAI;AACF,cAAMC,kBAAAA,eAAe,UAAU;AAC/B,mBAAW,QAAQ,WAAW,MAAM,OAAO,cAAY,SAAS,QAAQ,UAAU;AAClFD,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,MAAM,WAAW;AAAA,UACxB,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAGA,UAAM,iBAAiB,CAAC,WAAW;AACjC,cAAQ,QAAM;AAAA,QACZ,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AACH,iBAAO;AAAA,QACT;AACE,iBAAO;AAAA,MACV;AAAA,IACH;AAQAE,kBAAAA,UAAU,MAAM;AAEd,YAAM,mBAAmBF,cAAAA,MAAI,eAAe,oBAAoB;AAChE,UAAI,qBAAqB,YAAY;AACnCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD,mBAAW,MAAM;AACfA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,UACb,CAAO;AAAA,QACF,GAAE,IAAI;AACP;AAAA,MACD;AAED;IACF,CAAC;AAGDG,kBAAAA,OAAO,MAAM;AACX,YAAM,mBAAmBH,cAAAA,MAAI,eAAe,oBAAoB;AAChE,UAAI,qBAAqB,YAAY;AACnC;MACD;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvOD,GAAG,WAAWI,SAAe;"}