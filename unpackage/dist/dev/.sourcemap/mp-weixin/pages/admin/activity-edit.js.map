{"version":3,"file":"activity-edit.js","sources":["pages/admin/activity-edit.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRtaW4vYWN0aXZpdHktZWRpdC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-white px-4 pt-10 pb-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <IconImage name=\"back\" :size=\"18\" />\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-gray-900 text-lg font-medium\">编辑环保活动</text>\n        </view>\n        <view>\n          <button \n            class=\"publish-btn text-white text-sm bg-green-500 rounded-full px-4 py-1\"\n            :disabled=\"!canSave\"\n            :class=\"{'bg-gray-300': !canSave}\"\n            @tap=\"saveActivity\">\n            修改\n          </button>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"flex justify-center py-10\">\n      <image src=\"/static/images/loading.gif\" class=\"w-12 h-12\"></image>\n    </view>\n\n    <!-- 内容区 -->\n    <view v-else class=\"p-4\">\n      <!-- 活动标题 -->\n      <input \n        v-model=\"title\"\n        class=\"w-full p-3 bg-white rounded-lg mb-4\"\n        placeholder=\"请输入活动标题\"\n        maxlength=\"100\"\n      />\n      \n      <!-- 活动描述 -->\n      <textarea \n        v-model=\"description\" \n        class=\"w-full p-3 bg-white rounded-lg mb-4\" \n        placeholder=\"请输入活动描述...\" \n        maxlength=\"1000\"\n        auto-height>\n      </textarea>\n      \n      <!-- 活动时间 -->\n      <view class=\"flex items-center w-full p-3 bg-white rounded-lg mb-4\">\n        <IconImage name=\"calendar\" :size=\"18\" class=\"mr-2\" />\n        <input \n          v-model=\"activityTime\"\n          class=\"flex-1\"\n          placeholder=\"请输入活动时间，如：2023-10-01 14:00至18:00\"\n          maxlength=\"100\"\n        />\n      </view>\n      \n      <!-- 活动地点 -->\n      <view class=\"flex items-center w-full p-3 bg-white rounded-lg mb-4\">\n        <IconImage name=\"location\" :size=\"18\" class=\"mr-2\" />\n        <input \n          v-model=\"location\"\n          class=\"flex-1\"\n          placeholder=\"请输入活动地点\"\n          maxlength=\"200\"\n        />\n      </view>\n      \n      <!-- 活动状态 -->\n      <view class=\"status-selector w-full p-3 bg-white rounded-lg mb-4\">\n        <picker \n          @change=\"onStatusChange\" \n          :value=\"statusIndex\" \n          :range=\"statusOptions\">\n          <view class=\"picker-content\">\n            <text class=\"picker-text\">{{ statusOptions[statusIndex] }}</text>\n            <IconImage name=\"right\" :size=\"16\" />\n          </view>\n        </picker>\n      </view>\n      \n      <!-- 活动积分 -->\n      <input \n        v-model=\"point\"\n        class=\"w-full p-3 bg-white rounded-lg mb-4\"\n        placeholder=\"请输入活动完成可获得的积分数量\"\n        type=\"number\"\n      />\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue';\nimport { updateActivity, getActivities } from '../../services/activity.js';\nimport IconImage from '../../components/IconImage.vue';\n\n// 活动ID\nconst activityId = ref('');\n\n// 活动信息\nconst title = ref('');\nconst description = ref('');\nconst activityTime = ref('');\nconst location = ref('');\nconst statusIndex = ref(0);\nconst statusOptions = ['报名中', '未开始', '已结束'];\nconst point = ref('0');\nconst loading = ref(true);\n\n// 是否可以保存\nconst canSave = computed(() => {\n  return title.value.trim().length > 0 && \n         description.value.trim().length > 0 && \n         activityTime.value.trim().length > 0 && \n         location.value.trim().length > 0;\n});\n\n// 状态选择变化\nconst onStatusChange = (e) => {\n  statusIndex.value = e.detail.value;\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.showModal({\n    title: '提示',\n    content: '是否放弃修改？',\n    success: (res) => {\n      if (res.confirm) {\n        uni.navigateBack();\n      }\n    }\n  });\n};\n\n// 加载活动详情\nconst loadActivityDetail = async (id) => {\n  loading.value = true;\n  try {\n    const activities = await getActivities();\n    const activity = activities.find(item => item._id === id);\n    \n    if (!activity) {\n      uni.showToast({\n        title: '未找到活动信息',\n        icon: 'none'\n      });\n      setTimeout(() => {\n        uni.navigateBack();\n      }, 1500);\n      return;\n    }\n    \n    // 填充表单\n    title.value = activity.title;\n    description.value = activity.description;\n    activityTime.value = activity.activity_time;\n    location.value = activity.location;\n    point.value = activity.point.toString();\n    \n    // 设置状态\n    const statusValue = activity.status;\n    const index = statusOptions.findIndex(item => item === statusValue);\n    statusIndex.value = index > -1 ? index : 0;\n    \n  } catch (error) {\n    uni.showToast({\n      title: error.message || '获取活动信息失败',\n      icon: 'none'\n    });\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 保存活动\nconst saveActivity = async () => {\n  // 验证内容\n  if (!canSave.value) {\n    uni.showToast({\n      title: '请完善必填信息',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  try {\n    const activityData = {\n      _id: activityId.value,\n      title: title.value,\n      description: description.value,\n      activity_time: activityTime.value,\n      location: location.value,\n      status: statusOptions[statusIndex.value],\n      point: parseInt(point.value) || 0\n    };\n    \n    const result = await updateActivity(activityData);\n    uni.showToast({\n      title: '修改成功',\n      icon: 'success'\n    });\n    \n    // 延时返回，让用户看到修改成功提示\n    setTimeout(() => {\n      uni.navigateBack();\n    }, 1500);\n  } catch (error) {\n    uni.showToast({\n      title: error.message || '修改失败',\n      icon: 'none'\n    });\n  }\n};\n\n// 页面加载\nonMounted(() => {\n  // 检查管理员登录状态\n  const adminLoginStatus = uni.getStorageSync('admin_login_status');\n  if (adminLoginStatus !== 'loggedin') {\n    uni.showToast({\n      title: '请先登录',\n      icon: 'none'\n    });\n    setTimeout(() => {\n      uni.navigateTo({\n        url: '/pages/admin/login'\n      });\n    }, 1500);\n    return;\n  }\n  \n  // 获取页面参数\n  const page = getCurrentPages().pop();\n  const options = page.options || {};\n  \n  if (options.id) {\n    activityId.value = options.id;\n    loadActivityDetail(options.id);\n  } else {\n    uni.showToast({\n      title: '缺少活动ID',\n      icon: 'none'\n    });\n    setTimeout(() => {\n      uni.navigateBack();\n    }, 1500);\n  }\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f8f9fa;\n}\n\n.header {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n\n.publish-btn {\n  border: none;\n  min-width: 70px;\n  line-height: 1.8;\n}\n\n.status-selector {\n  box-sizing: border-box;\n}\n\n.picker-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.picker-text {\n  color: #333;\n}\n\n/* 工具类 */\n.bg-white { background-color: #ffffff; }\n.bg-green-500 { background-color: #4CAF50; }\n.bg-gray-300 { background-color: #d1d5db; }\n.text-white { color: #ffffff; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-600 { color: #4b5563; }\n.text-gray-900 { color: #111827; }\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.font-medium { font-weight: 500; }\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n.w-full { width: 100%; }\n.w-12 { width: 48px; }\n.h-12 { height: 48px; }\n.p-3 { padding: 12px; }\n.p-4 { padding: 16px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-1 { padding-top: 4px; padding-bottom: 4px; }\n.py-10 { padding-top: 40px; padding-bottom: 40px; }\n.pt-10 { padding-top: 40px; }\n.pb-3 { padding-bottom: 12px; }\n.mb-4 { margin-bottom: 16px; }\n.rounded-lg { border-radius: 8px; }\n.rounded-full { border-radius: 9999px; }\n.text-center { text-align: center; }\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n\n.mr-2 {\n  margin-right: 8px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/admin/activity-edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","getActivities","updateActivity","onMounted","MiniProgramPage"],"mappings":"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"}