{"version":3,"file":"dashboard.js","sources":["pages/admin/dashboard.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRtaW4vZGFzaGJvYXJkLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-green px-4 py-3\">\n      <view class=\"flex items-center\">\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的左侧占位 -->\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-white text-lg font-medium\">管理员控制台</text>\n        </view>\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的右侧占位 -->\n      </view>\n    </view>\n    \n    <!-- 欢迎信息 -->\n    <view class=\"welcome-container\">\n      <view class=\"welcome-card\">\n        <text class=\"welcome-title\">欢迎访问管理员控制台</text>\n        <text class=\"welcome-subtitle\">您可以在这里管理环保先锋小程序的核心内容</text>\n        <view class=\"welcome-stats\">\n          <view class=\"stat-item\">\n            <text class=\"stat-value\">\n              <text v-if=\"loading\">...</text>\n              <text v-else>{{ activityCount }}</text>\n            </text>\n            <text class=\"stat-label\">活动数量</text>\n          </view>\n          <view class=\"stat-item\">\n            <text class=\"stat-value\">6</text>\n            <text class=\"stat-label\">用户数量</text>\n          </view>\n          <view class=\"stat-item\">\n            <text class=\"stat-value\">\n              <text v-if=\"loading\">...</text>\n              <text v-else>{{ rewardCount }}</text>\n            </text>\n            <text class=\"stat-label\">商品数量</text>\n          </view>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 功能区域 -->\n    <view class=\"function-container\">\n      <view class=\"function-title\">管理功能</view>\n      \n      <view class=\"function-buttons\">\n        <!-- 环保活动信息管理 -->\n        <view class=\"function-button\" @tap=\"navigateToActivityManagement\">\n          <view class=\"button-icon bg-blue-50\">\n            <text class=\"iconfont icon-calendar text-blue-500 text-xl\"></text>\n          </view>\n          <text class=\"button-text\">环保活动信息管理</text>\n        </view>\n        \n        <!-- 环保知识和小贴士 -->\n        <view class=\"function-button\" @tap=\"navigateToKnowledgeManagement\">\n          <view class=\"button-icon bg-amber-50\">\n            <text class=\"iconfont icon-bulb text-amber-500 text-xl\"></text>\n          </view>\n          <text class=\"button-text\">环保知识和小贴士</text>\n        </view>\n        \n        <!-- 积分商城奖品管理 -->\n        <view class=\"function-button\" @tap=\"navigateToRewardsManagement\">\n          <view class=\"button-icon bg-green-50\">\n            <text class=\"iconfont icon-shopping-bag text-green-500 text-xl\"></text>\n          </view>\n          <text class=\"button-text\">积分商城奖品管理</text>\n        </view>\n\n        <!-- 积分系统重置 -->\n        <view class=\"function-button\" @tap=\"navigateToResetPoints\">\n          <view class=\"button-icon bg-red-50\">\n            <text class=\"iconfont icon-refresh text-red-500 text-xl\"></text>\n          </view>\n          <text class=\"button-text\">积分系统重置</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 退出按钮 -->\n    <view class=\"logout-container\">\n      <button class=\"logout-button\" @tap=\"handleLogout\">退出管理员账号</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { onMounted, ref } from 'vue';\nimport { getActivityCount } from '../../services/activity.js';\nimport { getRewardCount } from '../../services/mall.js';\n\n// 统计数据\nconst activityCount = ref(0);\nconst rewardCount = ref(0);\nconst loading = ref(true);\nconst hasError = ref(false);\n\n// 加载统计数据\nconst loadStats = async () => {\n  loading.value = true;\n  hasError.value = false;\n  \n  try {\n    // 先使用缓存数据快速渲染\n    const cachedActivityCount = uni.getStorageSync('activity_count') || 0;\n    const cachedRewardCount = uni.getStorageSync('reward_count') || 0;\n    activityCount.value = cachedActivityCount;\n    rewardCount.value = cachedRewardCount;\n    \n    // 然后再异步获取最新数据\n    Promise.all([\n      getActivityCount(),\n      getRewardCount()\n    ]).then(([countActivity, countRewards]) => {\n      activityCount.value = countActivity;\n      rewardCount.value = countRewards;\n      \n      // 只有在数据有变化时才更新缓存\n      if (cachedActivityCount !== countActivity) {\n        uni.setStorageSync('activity_count', countActivity);\n      }\n      if (cachedRewardCount !== countRewards) {\n        uni.setStorageSync('reward_count', countRewards);\n      }\n      \n      loading.value = false;\n    }).catch(error => {\n      console.error('获取统计数据失败:', error);\n      hasError.value = true;\n      loading.value = false;\n    });\n    \n  } catch (error) {\n    console.error('统计数据初始化失败:', error);\n    hasError.value = true;\n    // 使用兜底数据\n    if (!activityCount.value) activityCount.value = 3;\n    if (!rewardCount.value) rewardCount.value = 10;\n    loading.value = false;\n  }\n};\n\n// 检查管理员登录状态\nonMounted(() => {\n  const adminLoginStatus = uni.getStorageSync('admin_login_status');\n  if (adminLoginStatus !== 'loggedin') {\n    uni.showToast({\n      title: '请先登录',\n      icon: 'none'\n    });\n    \n    // 立即跳转到登录页，不使用setTimeout延迟\n    uni.navigateTo({\n      url: '/pages/admin/login'\n    });\n  } else {\n    // 加载统计数据\n    loadStats();\n  }\n});\n\n// 跳转到活动管理页面\nconst navigateToActivityManagement = () => {\n  uni.navigateTo({\n    url: '/pages/admin/activity-list'\n  });\n};\n\n// 跳转到环保知识管理页面\nconst navigateToKnowledgeManagement = () => {\n  uni.navigateTo({\n    url: '/pages/admin/knowledge-list'\n  });\n};\n\n// 跳转到积分商城奖品管理页面\nconst navigateToRewardsManagement = () => {\n  uni.navigateTo({\n    url: '/pages/admin/reward-list'\n  });\n};\n\n// 跳转到积分系统重置页面\nconst navigateToResetPoints = () => {\n  uni.navigateTo({\n    url: '/pages/admin/reset-points'\n  });\n};\n\n// 退出登录\nconst handleLogout = () => {\n  uni.showModal({\n    title: '退出提示',\n    content: '确认退出管理员账号？',\n    success: (res) => {\n      if (res.confirm) {\n        // 清除登录状态\n        uni.removeStorageSync('admin_login_status');\n        \n        // 返回设置页面\n        uni.navigateBack({\n          delta: 2  // 返回两级，跳过登录页面直接回到设置页面\n        });\n      }\n    }\n  });\n};\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f8f9fa;\n}\n\n.header {\n  padding-top: 44px;\n  padding-bottom: 12px;\n  box-sizing: content-box;\n}\n\n.bg-green {\n  background-color: #4CAF50;\n}\n\n.w-24px {\n  width: 24px;\n}\n\n.welcome-container {\n  padding: 20px;\n}\n\n.welcome-card {\n  background-color: white;\n  border-radius: 16px;\n  padding: 24px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n}\n\n.welcome-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: #333;\n  margin-bottom: 8px;\n}\n\n.welcome-subtitle {\n  font-size: 14px;\n  color: #666;\n  margin-bottom: 20px;\n}\n\n.welcome-stats {\n  display: flex;\n  justify-content: space-between;\n}\n\n.stat-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.stat-value {\n  font-size: 22px;\n  font-weight: 600;\n  color: #4CAF50;\n}\n\n.stat-label {\n  font-size: 12px;\n  color: #888;\n  margin-top: 4px;\n}\n\n.function-container {\n  padding: 0 20px 20px;\n}\n\n.function-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: #333;\n  margin-bottom: 16px;\n}\n\n.function-buttons {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.function-button {\n  display: flex;\n  align-items: center;\n  background-color: white;\n  border-radius: 12px;\n  padding: 16px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.button-icon {\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 16px;\n}\n\n.button-text {\n  font-size: 16px;\n  font-weight: 500;\n  color: #333;\n}\n\n.logout-container {\n  padding: 20px;\n  margin-top: 20px;\n}\n\n.logout-button {\n  width: 100%;\n  height: 48px;\n  line-height: 48px;\n  text-align: center;\n  background-color: white;\n  color: #f44336;\n  border-radius: 24px;\n  font-size: 16px;\n  font-weight: 500;\n  border: 1px solid #f0f0f0;\n}\n\n/* 工具类 */\n.text-white { color: #ffffff; }\n.text-green-500 { color: #4CAF50; }\n.text-blue-500 { color: #3b82f6; }\n.text-amber-500 { color: #f59e0b; }\n.text-red-500 { color: #ef4444; }\n\n.bg-green-50 { background-color: #e8f5e9; }\n.bg-blue-50 { background-color: #eff6ff; }\n.bg-amber-50 { background-color: #fffbeb; }\n.bg-red-50 { background-color: #fef2f2; }\n\n.text-lg { font-size: 18px; }\n.text-xl { font-size: 22px; }\n.font-medium { font-weight: 500; }\n\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.text-center { text-align: center; }\n\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/admin/dashboard.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","getActivityCount","getRewardCount","onMounted","MiniProgramPage"],"mappings":";;;;;;;AA6FA,UAAM,gBAAgBA,cAAAA,IAAI,CAAC;AAC3B,UAAM,cAAcA,cAAAA,IAAI,CAAC;AACzB,UAAM,UAAUA,cAAAA,IAAI,IAAI;AACxB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAG1B,UAAM,YAAY,YAAY;AAC5B,cAAQ,QAAQ;AAChB,eAAS,QAAQ;AAEjB,UAAI;AAEF,cAAM,sBAAsBC,cAAG,MAAC,eAAe,gBAAgB,KAAK;AACpE,cAAM,oBAAoBA,cAAG,MAAC,eAAe,cAAc,KAAK;AAChE,sBAAc,QAAQ;AACtB,oBAAY,QAAQ;AAGpB,gBAAQ,IAAI;AAAA,UACVC,mCAAkB;AAAA,UAClBC,6BAAgB;AAAA,QACjB,CAAA,EAAE,KAAK,CAAC,CAAC,eAAe,YAAY,MAAM;AACzC,wBAAc,QAAQ;AACtB,sBAAY,QAAQ;AAGpB,cAAI,wBAAwB,eAAe;AACzCF,0BAAAA,MAAI,eAAe,kBAAkB,aAAa;AAAA,UACnD;AACD,cAAI,sBAAsB,cAAc;AACtCA,0BAAAA,MAAI,eAAe,gBAAgB,YAAY;AAAA,UAChD;AAED,kBAAQ,QAAQ;AAAA,QACtB,CAAK,EAAE,MAAM,WAAS;AAChBA,iFAAc,aAAa,KAAK;AAChC,mBAAS,QAAQ;AACjB,kBAAQ,QAAQ;AAAA,QACtB,CAAK;AAAA,MAEF,SAAQ,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,oCAAA,cAAc,KAAK;AACjC,iBAAS,QAAQ;AAEjB,YAAI,CAAC,cAAc;AAAO,wBAAc,QAAQ;AAChD,YAAI,CAAC,YAAY;AAAO,sBAAY,QAAQ;AAC5C,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGAG,kBAAAA,UAAU,MAAM;AACd,YAAM,mBAAmBH,cAAAA,MAAI,eAAe,oBAAoB;AAChE,UAAI,qBAAqB,YAAY;AACnCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAGDA,sBAAAA,MAAI,WAAW;AAAA,UACb,KAAK;AAAA,QACX,CAAK;AAAA,MACL,OAAS;AAEL;MACD;AAAA,IACH,CAAC;AAGD,UAAM,+BAA+B,MAAM;AACzCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;AAGA,UAAM,gCAAgC,MAAM;AAC1CA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;AAGA,UAAM,8BAA8B,MAAM;AACxCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;AAGA,UAAM,wBAAwB,MAAM;AAClCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEfA,gCAAI,kBAAkB,oBAAoB;AAG1CA,0BAAAA,MAAI,aAAa;AAAA,cACf,OAAO;AAAA;AAAA,YACjB,CAAS;AAAA,UACF;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;AC9MA,GAAG,WAAWI,SAAe;"}