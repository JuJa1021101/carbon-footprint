{"version":3,"file":"home.js","sources":["pages/home/home.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9ob21lLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"px-4 pt-10 pb-4 bg-white\">\n      <view class=\"flex items-center justify-between mb-4\">\n        <text class=\"text-xl font-bold\">环保先锋</text>\n        <view class=\"flex\">\n          <view class=\"mr-4\">\n            <icon-image :name=\"'notification'\" class=\"text-gray-500\" size=\"18\"></icon-image>\n          </view>\n          <view>\n            <icon-image :name=\"'calendar'\" class=\"text-gray-500\" size=\"18\"></icon-image>\n          </view>\n        </view>\n      </view>\n\n      <!-- 搜索框 -->\n      <view class=\"relative search-container\">\n        <view class=\"search-input-container\">\n          <input \n            type=\"text\" \n            v-model=\"searchKeyword\"\n            class=\"search-bar w-full bg-gray-100 py-2 px-4 pr-10 text-sm\" \n            placeholder=\"搜索环保知识、活动...\"\n            @confirm=\"handleSearch\">\n          <icon-image \n            v-if=\"searchKeyword\" \n            :name=\"'close-circle'\"\n            class=\"absolute right-10 top-2-5 text-gray-400\" \n            size=\"16\"\n            @tap=\"clearSearch\">\n          </icon-image>\n          <icon-image :name=\"'search'\" class=\"absolute right-3 top-2-5 text-gray-400\" size=\"16\" @tap=\"handleSearch\"></icon-image>\n        </view>\n        \n        <!-- 搜索状态 -->\n        <view v-if=\"isSearchMode\" class=\"search-status mt-2\">\n          <view class=\"flex items-center\">\n            <text class=\"text-sm\">关键词: \"{{ searchKeyword }}\"</text>\n            <text class=\"text-xs text-gray-500 ml-2\">(找到 {{ searchResults.length }} 条结果)</text>\n            <view class=\"ml-auto\">\n              <text class=\"text-green-500 text-sm\" @tap=\"exitSearch\">退出搜索</text>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 分类导航 -->\n    <view class=\"px-4 py-4 bg-white\">\n      <scroll-view scroll-x class=\"flex whitespace-nowrap pb-2\" show-scrollbar=\"false\">\n        <text class=\"nav-pill active-pill flex-shrink-0\">全部</text>\n        <text class=\"nav-pill bg-gray-100 flex-shrink-0 space-left\">垃圾分类</text>\n        <text class=\"nav-pill bg-gray-100 flex-shrink-0 space-left\">节能减排</text>\n        <text class=\"nav-pill bg-gray-100 flex-shrink-0 space-left\">资源回收</text>\n        <text class=\"nav-pill bg-gray-100 flex-shrink-0 space-left\">低碳生活</text>\n      </scroll-view>\n    </view>\n\n    <!-- 内容区 -->\n    <view class=\"p-4\">\n      <!-- 搜索结果 -->\n      <view v-if=\"isSearchMode\">\n        <!-- 搜索结果为空 -->\n        <view v-if=\"searchResults.length === 0\" class=\"flex flex-col items-center py-10\">\n          <icon-image :name=\"'search'\" class=\"text-gray-300 text-5xl mb-4\" size=\"48\"></icon-image>\n          <text class=\"text-gray-500\">没有找到相关内容</text>\n          <text class=\"text-gray-400 text-sm mt-2\">换个关键词试试吧</text>\n        </view>\n        \n        <!-- 环保知识搜索结果 -->\n        <view v-else>\n          <!-- 知识搜索结果 -->\n          <view v-if=\"searchKnowledgeResults.length > 0\" class=\"mb-6\">\n            <view class=\"flex justify-between items-center mb-3\">\n              <text class=\"text-lg font-semibold\">环保知识</text>\n              <view class=\"flex items-center\" @tap=\"navigateToKnowledgeList\">\n                <text class=\"text-sm text-gray-500\">查看更多</text>\n                <icon-image :name=\"'right'\" class=\"text-xs text-gray-500 ml-1\" size=\"12\"></icon-image>\n              </view>\n            </view>\n            \n            <!-- 知识卡片列表 -->\n            <view \n              v-for=\"item in searchKnowledgeResults\" \n              :key=\"item._id\"\n              class=\"card bg-white mb-4\" \n              @tap=\"navigateToKnowledgeDetail(item._id)\">\n              \n              <template v-if=\"item.image\">\n                <image :src=\"item.image\" mode=\"aspectFill\" class=\"knowledge-img\"></image>\n                <view class=\"p-3\">\n                  <view class=\"flex mb-2\">\n                    <text class=\"green-tag\" v-if=\"item.tags\"># {{ item.tags.split(',')[0] }}</text>\n                  </view>\n                  <text class=\"font-medium mb-2 block\">{{ item.title }}</text>\n                  <view class=\"flex items-center text-gray-500 text-xs\">\n                    <icon-image :name=\"'eye'\" class=\"mr-1\" size=\"14\"></icon-image>\n                    <text class=\"mr-3\">{{ item.views || 0 }}</text>\n                    <icon-image :name=\"'like'\" class=\"mr-1\" size=\"14\"></icon-image>\n                    <text>{{ item.likes || 0 }}</text>\n                    <text class=\"ml-auto\">{{ formatDate(item.created_at) }}</text>\n                  </view>\n                </view>\n              </template>\n              \n              <template v-else>\n                <view class=\"flex\">\n                  <view class=\"p-3 flex-grow\">\n                    <view class=\"flex mb-2\">\n                      <text class=\"green-tag\" v-if=\"item.tags\"># {{ item.tags.split(',')[0] }}</text>\n                    </view>\n                    <text class=\"font-medium mb-2 block\">{{ item.title }}</text>\n                    <view class=\"flex items-center text-gray-500 text-xs\">\n                      <icon-image :name=\"'eye'\" class=\"mr-1\" size=\"14\"></icon-image>\n                      <text class=\"mr-3\">{{ item.views || 0 }}</text>\n                      <icon-image :name=\"'like'\" class=\"mr-1\" size=\"14\"></icon-image>\n                      <text>{{ item.likes || 0 }}</text>\n                      <text class=\"ml-auto\">{{ formatDate(item.created_at) }}</text>\n                    </view>\n                  </view>\n                </view>\n              </template>\n            </view>\n          </view>\n          \n          <!-- 活动搜索结果 -->\n          <view v-if=\"searchActivityResults.length > 0\">\n            <view class=\"flex justify-between items-center mb-3\">\n              <text class=\"text-lg font-semibold\">公益活动</text>\n              <view class=\"flex items-center\" @tap=\"navigateToAllActivities\">\n                <text class=\"text-sm text-gray-500\">查看更多</text>\n                <icon-image :name=\"'right'\" class=\"text-xs text-gray-500 ml-1\" size=\"12\"></icon-image>\n              </view>\n            </view>\n            \n            <!-- 活动卡片列表 -->\n            <view \n              v-for=\"(activity, index) in searchActivityResults\" \n              :key=\"activity._id || index\"\n              class=\"activity-card bg-white mb-4 rounded-lg\"\n              @tap=\"navigateToDetail(activity._id)\">\n              <view class=\"p-4\">\n                <!-- 活动标题和状态 -->\n                <view class=\"flex justify-between items-center mb-2\">\n                  <text class=\"font-medium text-base\">{{ activity.title }}</text>\n                  <text \n                    :class=\"getStatusTextClass(activity)\"\n                    class=\"text-xs\">\n                    {{ activity.status }}\n                  </text>\n                </view>\n                \n                <!-- 活动描述 -->\n                <text class=\"text-gray-600 text-sm mb-3\">{{ activity.description }}</text>\n                \n                <!-- 活动地点 -->\n                <view class=\"flex items-center mb-2 text-gray-500 text-sm\">\n                  <icon-image :name=\"'location'\" class=\"mr-1\" size=\"14\"></icon-image>\n                  <text>{{ activity.location }}</text>\n                </view>\n                \n                <!-- 活动时间 -->\n                <view class=\"flex items-center mb-3 text-gray-500 text-sm\">\n                  <icon-image :name=\"'calendar'\" class=\"mr-1\" size=\"14\"></icon-image>\n                  <text>{{ activity.activity_time }}</text>\n                </view>\n                \n                <!-- 参与人数和报名按钮 -->\n                <view class=\"flex items-center justify-between\">\n                  <!-- 参与人数 -->\n                  <view class=\"flex items-center\">\n                    <view class=\"flex mr-2\">\n                      <view class=\"activity-avatar-icon\">🧑</view>\n                      <view class=\"activity-avatar-icon ml-n2\">👩</view>\n                      <view class=\"activity-avatar-icon ml-n2\">👨</view>\n                    </view>\n                    <text class=\"text-xs text-gray-500\">{{ getParticipantsCount(activity) }}人已报名</text>\n                  </view>\n                  \n                  <!-- 报名按钮 -->\n                  <button \n                    :class=\"getActionButtonClass(activity)\"\n                    @tap.stop=\"handleActivityAction(activity)\">\n                    {{ activity.status === '报名中' ? '立即报名' : '查看详情' }}\n                  </button>\n                </view>\n              </view>\n            </view>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 正常首页内容 -->\n      <view v-else>\n        <!-- 推荐环保知识 -->\n        <view class=\"mb-6\">\n          <view class=\"flex justify-between items-center mb-3\">\n            <text class=\"text-lg font-semibold\">环保知识</text>\n            <view class=\"flex items-center\" @tap=\"navigateToKnowledgeList\">\n              <text class=\"text-sm text-gray-500\">查看更多</text>\n              <icon-image :name=\"'right'\" class=\"text-xs text-gray-500 ml-1\" size=\"12\"></icon-image>\n            </view>\n          </view>\n\n          <!-- 静态知识卡片 -->\n          <!-- 第一张卡片 -->\n          <view class=\"card bg-white mb-4\" @tap=\"navigateToKnowledgeDetail('static1')\">\n            <image src=\"/static/images/userspost/garbage-sorting.jpeg\" mode=\"aspectFill\" class=\"knowledge-img\"></image>\n            <view class=\"p-3\">\n              <view class=\"flex mb-2\">\n                <text class=\"green-tag\"># 垃圾分类</text>\n              </view>\n              <text class=\"font-medium mb-2 block\">一张图看懂家庭垃圾如何正确分类</text>\n              <view class=\"flex items-center text-gray-500 text-xs\">\n                <icon-image :name=\"'eye'\" class=\"mr-1\" size=\"14\"></icon-image>\n                <text class=\"mr-3\">1234</text>\n                <icon-image :name=\"'like'\" class=\"mr-1\" size=\"14\"></icon-image>\n                <text>56</text>\n                <text class=\"ml-auto\">3小时前</text>\n              </view>\n            </view>\n          </view>\n\n          <!-- 第二张卡片 -->\n          <view class=\"card bg-white\" @tap=\"navigateToKnowledgeDetail('static2')\">\n            <view class=\"flex\">\n              <view class=\"p-3 flex-grow\">\n                <view class=\"flex mb-2\">\n                  <text class=\"green-tag\"># 节能减排</text>\n                </view>\n                <text class=\"font-medium mb-2 block\">日常用电小窍门，轻松节能30%</text>\n                <view class=\"flex items-center text-gray-500 text-xs\">\n                  <icon-image :name=\"'eye'\" class=\"mr-1\" size=\"14\"></icon-image>\n                  <text class=\"mr-3\">867</text>\n                  <icon-image :name=\"'like'\" class=\"mr-1\" size=\"14\"></icon-image>\n                  <text>42</text>\n                  <text class=\"ml-auto\">昨天</text>\n                </view>\n              </view>\n              <view class=\"p-3\">\n                <image src=\"/static/images/userspost/energy-saving.jpeg\" mode=\"aspectFill\" class=\"small-img\"></image>\n              </view>\n            </view>\n          </view>\n        </view>\n\n        <!-- 公益活动 -->\n        <view>\n          <view class=\"flex justify-between items-center mb-3\">\n            <text class=\"text-lg font-semibold\">公益活动</text>\n            <view class=\"flex items-center\" @tap=\"navigateToAllActivities\">\n              <text class=\"text-sm text-gray-500\">查看更多</text>\n              <icon-image :name=\"'right'\" class=\"text-xs text-gray-500 ml-1\" size=\"12\"></icon-image>\n            </view>\n          </view>\n\n          <!-- 加载中 -->\n          <view v-if=\"loading\" class=\"flex justify-center py-4\">\n            <view class=\"loading-circle\"></view>\n          </view>\n          \n          <!-- 错误提示 -->\n          <view v-else-if=\"hasError\" class=\"card bg-white p-4\">\n            <view class=\"flex flex-col items-center justify-center py-4\">\n              <text class=\"text-red-500 mb-2\">加载失败</text>\n              <text class=\"text-gray-500 text-sm mb-3\">{{ errorMessage }}</text>\n              <button class=\"bg-green-50 text-green-600 text-sm px-4 py-2 rounded-full\" @tap=\"getActivityList\">\n                重新加载\n              </button>\n            </view>\n          </view>\n          \n          <!-- 无活动提示 -->\n          <view v-else-if=\"activities.length === 0\" class=\"card bg-white p-4\">\n            <view class=\"flex flex-col items-center justify-center py-4\">\n              <text class=\"text-gray-500\">暂无公益活动，敬请期待</text>\n            </view>\n          </view>\n\n          <!-- 活动卡片 -->\n          <block v-else>\n            <view \n              v-for=\"(activity, index) in activities\" \n              :key=\"activity._id || index\"\n              class=\"activity-card bg-white mb-4 rounded-lg\"\n              @tap=\"navigateToDetail(activity._id)\">\n              <view class=\"p-4\">\n                <!-- 活动标题和状态 -->\n                <view class=\"flex justify-between items-center mb-2\">\n                  <text class=\"font-medium text-base\">{{ activity.title }}</text>\n                  <text \n                    :class=\"getStatusTextClass(activity)\"\n                    class=\"text-xs\">\n                    {{ getDisplayStatus(activity) }}\n                  </text>\n                </view>\n                \n                <!-- 活动描述 -->\n                <text class=\"text-gray-600 text-sm mb-3\">{{ activity.description }}</text>\n                \n                <!-- 活动地点 -->\n                <view class=\"flex items-center mb-2 text-gray-500 text-sm\">\n                  <icon-image :name=\"'location'\" class=\"mr-1\" size=\"14\"></icon-image>\n                  <text>{{ activity.location }}</text>\n                </view>\n                \n                <!-- 活动时间 -->\n                <view class=\"flex items-center mb-3 text-gray-500 text-sm\">\n                  <icon-image :name=\"'calendar'\" class=\"mr-1\" size=\"14\"></icon-image>\n                  <text>{{ activity.activity_time }}</text>\n                </view>\n                \n                <!-- 参与人数和报名按钮 -->\n                <view class=\"flex items-center justify-between\">\n                  <!-- 参与人数 -->\n                  <view class=\"flex items-center\">\n                    <view class=\"flex mr-2\">\n                      <view class=\"activity-avatar-icon\">🧑</view>\n                      <view class=\"activity-avatar-icon ml-n2\">👩</view>\n                      <view class=\"activity-avatar-icon ml-n2\">👨</view>\n                    </view>\n                    <text class=\"text-xs text-gray-500\">{{ getParticipantsCount(activity) }}人已报名</text>\n                  </view>\n                  \n                  <!-- 报名按钮 -->\n                  <button \n                    :class=\"getActionButtonClass(activity)\"\n                    @tap.stop=\"handleActivityAction(activity)\">\n                    {{ getActionButtonText(activity) }}\n                  </button>\n                </view>\n              </view>\n            </view>\n          </block>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, onErrorCaptured, computed } from 'vue';\nimport { onShow, onPullDownRefresh } from '@dcloudio/uni-app';\nimport { getTopActivities, enrollActivity } from '../../services/userActivity.js';\nimport { searchContent } from '../../services/search.js';\nimport { getKnowledgeList } from '../../services/knowledge.js';\nimport IconImage from '../../components/IconImage.vue';\n\n// 为了在模板中使用组件，需要创建别名\nconst IconEye = IconImage;\nconst IconLike = IconImage;\nconst IconHeart = IconImage;\nconst IconLocation = IconImage;\nconst IconCalendar = IconImage;\nconst IconRight = IconImage;\nconst IconSearch = IconImage;\nconst IconCloseCircle = IconImage;\n\n// 活动列表\nconst activities = ref([]);\nconst loading = ref(true);\nconst hasError = ref(false);\nconst errorMessage = ref('');\n\n// 环保知识列表\nconst knowledgeList = ref([]);\nconst knowledgeLoading = ref(false);\n\n// 搜索相关\nconst searchKeyword = ref('');\nconst searchResults = ref([]);\nconst isSearchMode = ref(false);\nconst searchTotal = ref(0);\n\n// 捕获错误\nonErrorCaptured((err, instance, info) => {\n  console.error('首页捕获到错误:', err);\n  console.log('错误发生在:', info);\n  hasError.value = true;\n  errorMessage.value = err.message || '加载数据时出错';\n  return false; // 阻止错误继续传播\n});\n\n// 获取活动列表\nconst getActivityList = async () => {\n  loading.value = true;\n  hasError.value = false;\n  try {\n    console.log('开始获取首页活动列表...');\n    const result = await getTopActivities();\n    console.log('获取到的活动列表:', result);\n    \n    if (!result || result.length === 0) {\n      console.warn('没有活动数据，显示空状态');\n      activities.value = [];\n    } else {\n      activities.value = result;\n      console.log('首页显示的活动数量:', activities.value.length);\n      activities.value.forEach((activity, index) => {\n        console.log(`活动${index+1}: ${activity.title}, 状态: ${activity.status}, 已报名: ${activity.isEnrolled}, 已打卡: ${activity.isCheckedIn}`);\n      });\n    }\n  } catch (error) {\n    console.error('获取活动列表失败', error);\n    hasError.value = true;\n    errorMessage.value = error.message || '获取活动数据失败';\n    activities.value = [];\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 下拉刷新处理函数\nonPullDownRefresh(async () => {\n  console.log('触发下拉刷新...');\n  try {\n    await getActivityList();\n    uni.showToast({\n      title: '刷新成功',\n      icon: 'success',\n      duration: 1500\n    });\n  } catch (error) {\n    console.error('刷新失败:', error);\n    uni.showToast({\n      title: '刷新失败',\n      icon: 'none',\n      duration: 1500\n    });\n  } finally {\n    // 停止下拉刷新动画\n    uni.stopPullDownRefresh();\n  }\n});\n\n// 获取状态文本样式类\nconst getStatusTextClass = (activity) => {\n  if (activity.isCheckedIn) {\n    return 'status-tag status-completed'; // 已完成打卡，显示灰色\n  } else if (activity.isEnrolled) {\n    return 'status-tag status-ongoing'; // 已报名但未打卡，显示绿色\n  }\n  \n  switch (activity.status) {\n    case '报名中':\n      return 'status-tag status-enrolling'; // 报名中，显示橙色\n    case '未开始':\n      return 'status-tag status-upcoming'; // 未开始，显示蓝色\n    case '已结束':\n      return 'status-tag status-ended'; // 已结束，显示灰色\n    default:\n      return 'status-tag status-default';\n  }\n};\n\n// 获取用户端显示的状态文本\nconst getDisplayStatus = (activity) => {\n  if (activity.isCheckedIn) {\n    return '已完成'; // 已完成打卡\n  } else if (activity.isEnrolled) {\n    return '进行中'; // 已报名但未打卡\n  }\n  \n  return activity.status; // 否则显示原始状态\n};\n\n// 获取操作按钮文本\nconst getActionButtonText = (activity) => {\n  if (activity.isCheckedIn) {\n    return '已完成';\n  } else if (activity.isEnrolled) {\n    return '查看详情';\n  } else if (activity.status === '未开始') {\n    return '等待开始';\n  } else if (activity.status === '已结束') {\n    return '已结束';\n  } else {\n    return '立即报名';\n  }\n};\n\n// 获取按钮样式类\nconst getActionButtonClass = (activity) => {\n  if (activity.status === '未开始' || activity.status === '已结束') {\n    return 'ml-auto bg-gray-200 text-gray-500 text-sm px-4 py-1 rounded-full';\n  } else {\n    return 'ml-auto bg-green-50 text-green-600 text-sm px-4 py-1 rounded-full';\n  }\n};\n\n// 处理活动操作\nconst handleActivityAction = (activity) => {\n  if (activity.isCheckedIn) {\n    // 已完成，不做任何操作\n    uni.showToast({\n      title: '您已完成该活动',\n      icon: 'none'\n    });\n  } else if (activity.isEnrolled) {\n    // 已报名但未完成，跳转到详情页\n    uni.navigateTo({\n      url: `/pages/home/activity-detail?id=${activity._id}`\n    });\n  } else if (activity.status === '报名中') {\n    // 报名中，进行报名操作\n    handleEnrollActivity(activity._id);\n  } else {\n    // 其他状态，跳转到详情页\n    uni.navigateTo({\n      url: `/pages/home/activity-detail?id=${activity._id}`\n    });\n  }\n};\n\n// 处理报名活动\nconst handleEnrollActivity = async (activityId) => {\n  try {\n    const result = await enrollActivity(activityId);\n    if (result && result.success) {\n      uni.showToast({\n        title: '报名成功',\n        icon: 'success'\n      });\n      \n      // 更新本地活动列表\n      const index = activities.value.findIndex(item => item._id === activityId);\n      if (index > -1) {\n        activities.value[index].isEnrolled = true;\n      }\n    } else {\n      uni.showToast({\n        title: result.message || '报名失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('报名活动失败', error);\n    uni.showToast({\n      title: '报名失败，请稍后再试',\n      icon: 'none'\n    });\n  }\n};\n\n// 获取参与人数\nconst getParticipantsCount = (activity) => {\n  return activity.enrollCount || 0;\n};\n\n// 跳转到活动详情\nconst navigateToDetail = (activityId) => {\n  uni.navigateTo({\n    url: `/pages/home/activity-detail?id=${activityId}`\n  });\n};\n\n// 跳转到全部活动\nconst navigateToAllActivities = () => {\n  uni.navigateTo({\n    url: '/pages/home/activity-list'\n  });\n};\n\n// 跳转到知识详情页\nconst navigateToKnowledgeDetail = (knowledgeId) => {\n  if (knowledgeId === 'static1') {\n    uni.navigateTo({\n      url: '/pages/home/knowledge-static?id=1'\n    });\n  } else if (knowledgeId === 'static2') {\n    uni.navigateTo({\n      url: '/pages/home/knowledge-static?id=2'\n    });\n  } else {\n    uni.navigateTo({\n      url: `/pages/home/knowledge-detail?id=${knowledgeId}`\n    });\n  }\n};\n\n// 跳转到知识列表页\nconst navigateToKnowledgeList = () => {\n  uni.navigateTo({\n    url: '/pages/home/knowledge-list'\n  });\n};\n\n// 执行搜索\nconst handleSearch = () => {\n  if (!searchKeyword.value.trim()) {\n    uni.showToast({\n      title: '请输入搜索关键词',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  performSearch(searchKeyword.value);\n};\n\n// 清除搜索内容\nconst clearSearch = () => {\n  searchKeyword.value = '';\n  if (isSearchMode.value) {\n    exitSearch();\n  }\n};\n\n// 退出搜索模式\nconst exitSearch = () => {\n  isSearchMode.value = false;\n  searchResults.value = [];\n  searchKeyword.value = '';\n};\n\n// 搜索处理\nconst performSearch = async (keyword) => {\n  try {\n    isSearchMode.value = true;\n    const results = await searchContent(keyword);\n    searchResults.value = results;\n    searchTotal.value = results.length;\n  } catch (error) {\n    console.error('搜索失败', error);\n    uni.showToast({\n      title: '搜索失败，请稍后再试',\n      icon: 'none'\n    });\n    searchResults.value = [];\n  }\n};\n\n// 初始化加载活动列表\nonMounted(() => {\n  getActivityList();\n});\n\n// 每次显示页面时刷新活动\nonShow(() => {\n  console.log('首页显示，刷新活动数据...');\n  setTimeout(() => {\n    getActivityList();\n  }, 500); // 延迟加载，避免初始化问题\n});\n\n// 计算属性：过滤知识搜索结果\nconst searchKnowledgeResults = computed(() => {\n  return searchResults.value.filter(item => item.type === 'knowledge');\n});\n\n// 计算属性：过滤活动搜索结果\nconst searchActivityResults = computed(() => {\n  return searchResults.value.filter(item => item.type === 'activity');\n});\n\n// 添加日期格式化函数\n// 格式化日期\nconst formatDate = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  const now = new Date();\n  const diff = now - date;\n  \n  // 一小时内\n  if (diff < 60 * 60 * 1000) {\n    const minutes = Math.floor(diff / (60 * 1000));\n    return `${minutes}分钟前`;\n  }\n  \n  // 24小时内\n  if (diff < 24 * 60 * 60 * 1000) {\n    const hours = Math.floor(diff / (60 * 60 * 1000));\n    return `${hours}小时前`;\n  }\n  \n  // 昨天\n  const yesterday = new Date(now);\n  yesterday.setDate(yesterday.getDate() - 1);\n  if (date.getDate() === yesterday.getDate()) {\n    return '昨天';\n  }\n  \n  // 今年内\n  if (date.getFullYear() === now.getFullYear()) {\n    return `${date.getMonth() + 1}月${date.getDate()}日`;\n  }\n  \n  // 其他\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n};\n</script>\n\n<style>\n.container {\n  background-color: #f8f9fa;\n  font-family: \"PingFang SC\", \"Helvetica Neue\", Arial, sans-serif;\n  color: #333;\n  padding-bottom: 80px;\n}\n\n.search-bar {\n  border-radius: 20px;\n}\n\n.nav-pill {\n  border-radius: 16px;\n  padding: 6px 12px;\n  font-size: 14px;\n  display: inline-block;\n}\n\n.active-pill {\n  background-color: #4CAF50;\n  color: white;\n}\n\n.card {\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n}\n\n.green-tag {\n  background-color: rgba(76, 175, 80, 0.1);\n  color: #4CAF50;\n  border-radius: 12px;\n  padding: 2px 10px;\n  font-size: 12px;\n  display: inline-block;\n}\n\n.avatar-group {\n  display: flex;\n  margin-right: -10px;\n}\n\n.avatar-sm {\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  border: 1px solid white;\n  margin-right: -10px;\n  object-fit: cover;\n}\n\n/* 修复间距类 */\n.space-left {\n  margin-left: 12px;\n}\n\n.tag-space {\n  margin-left: 8px;\n}\n\n/* 图片样式优化 */\n.knowledge-img {\n  height: 140px;\n  width: 100%;\n  object-fit: cover;\n  object-position: center;\n}\n\n.small-img {\n  width: 96px;\n  height: 96px;\n  object-fit: cover;\n  object-position: center;\n  border-radius: 8px;\n}\n\n/* 工具类 */\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.pt-10 { padding-top: 40px; }\n.pb-4 { padding-bottom: 16px; }\n.py-4 { padding-top: 16px; padding-bottom: 16px; }\n.p-4 { padding: 16px; }\n.p-3 { padding: 12px; }\n.mb-4 { margin-bottom: 16px; }\n.mb-3 { margin-bottom: 12px; }\n.mb-2 { margin-bottom: 8px; }\n.mb-1 { margin-bottom: 4px; }\n.mr-4 { margin-right: 16px; }\n.mr-3 { margin-right: 12px; }\n.mr-2 { margin-right: 8px; }\n.mr-1 { margin-right: 4px; }\n.ml-auto { margin-left: auto; }\n.ml-2 { margin-left: 8px; }\n.ml-1 { margin-left: 4px; }\n.mt-3 { margin-top: 12px; }\n.mt-1 { margin-top: 4px; }\n.mx-2 { margin-left: 8px; margin-right: 8px; }\n.my-auto { margin-top: auto; margin-bottom: auto; }\n\n.bg-white { background-color: #ffffff; }\n.bg-gray-100 { background-color: #f3f4f6; }\n.bg-green-50 { background-color: #f0fdf4; }\n\n.text-xl { font-size: 20px; }\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.text-xs { font-size: 12px; }\n.font-bold { font-weight: 700; }\n.font-semibold { font-weight: 600; }\n.font-medium { font-weight: 500; }\n\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n.text-green-500 { color: #4CAF50; }\n.text-green-600 { color: #4CAF50; }\n.text-yellow-500 { color: #F59E0B; }\n\n.flex { display: flex; }\n.flex-grow { flex-grow: 1; }\n.flex-shrink-0 { flex-shrink: 0; }\n.items-center { align-items: center; }\n.justify-between { justify-content: space-between; }\n\n.w-full { width: 100%; }\n.h-32 { height: 128px; }\n.w-24 { width: 96px; }\n.h-24 { height: 96px; }\n\n.rounded-md { border-radius: 6px; }\n.rounded-full { border-radius: 9999px; }\n\n.object-cover { object-fit: cover; }\n\n.shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }\n\n.pb-2 { padding-bottom: 8px; }\n\n.whitespace-nowrap { white-space: nowrap; }\n\n.relative { position: relative; }\n.absolute { position: absolute; }\n.right-3 { right: 12px; }\n.top-2-5 { top: 10px; }\n\n.activity-card {\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n}\n\n.activity-avatar-icon {\n  width: 24px;\n  height: 24px;\n  background-color: #f3f4f6;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  border: 1px solid white;\n}\n\n.ml-n2 {\n  margin-left: -8px;\n}\n\n/* 搜索容器样式 */\n.search-container {\n  margin-bottom: 5px;\n}\n\n.search-status {\n  background-color: #f8f9fa;\n  padding: 5px 8px;\n  border-radius: 8px;\n}\n\n.mt-2 {\n  margin-top: 8px;\n}\n\n/* 状态标签样式 */\n.status-tag {\n  font-size: 12px;\n  font-weight: 600;\n  border-radius: 9999px;\n  padding: 2px 8px;\n}\n\n.status-enrolling {\n  color: #F59E0B;\n  background-color: rgba(245, 158, 11, 0.1);\n}\n\n.status-ongoing {\n  color: #4CAF50;\n  background-color: rgba(76, 175, 80, 0.1);\n}\n\n.status-upcoming {\n  color: #3b82f6;\n  background-color: rgba(59, 130, 246, 0.1);\n}\n\n.status-ended, .status-completed {\n  color: #6b7280;\n  background-color: rgba(107, 114, 128, 0.1);\n}\n\n.status-default {\n  color: #6b7280;\n  background-color: rgba(107, 114, 128, 0.1);\n}\n\n/* 加载圈样式 */\n.loading-circle {\n  width: 30px;\n  height: 30px;\n  border: 3px solid rgba(76, 175, 80, 0.2);\n  border-top: 3px solid #4CAF50;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/home/home.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onErrorCaptured","uni","getTopActivities","onPullDownRefresh","enrollActivity","searchContent","onMounted","onShow","computed","MiniProgramPage"],"mappings":"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"}