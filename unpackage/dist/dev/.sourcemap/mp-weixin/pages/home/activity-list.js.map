{"version":3,"file":"activity-list.js","sources":["pages/home/activity-list.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9hY3Rpdml0eS1saXN0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-white px-4 pt-10 pb-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <image src=\"/static/images/icons/icon-back.svg\" class=\"back-icon\"></image>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-gray-900 text-lg font-medium\">公益活动</text>\n        </view>\n        <view class=\"more-btn\">\n          <image src=\"/static/images/icons/icon-more.svg\" class=\"more-icon\"></image>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"flex justify-center py-10\">\n      <view class=\"loading-circle\"></view>\n    </view>\n    \n    <!-- 内容区 -->\n    <view v-else class=\"p-4\">\n      <!-- 无活动提示 -->\n      <view v-if=\"activities.length === 0\" class=\"empty-container\">\n        <text class=\"empty-text\">暂无公益活动，敬请期待</text>\n      </view>\n      \n      <!-- 活动列表 -->\n      <view v-else>\n        <view \n          v-for=\"(activity, index) in activities\" \n          :key=\"activity._id\"\n          class=\"card bg-white mb-4\">\n          <view class=\"p-3\">\n            <view class=\"flex justify-between items-center mb-2\">\n              <text class=\"font-medium\">{{ activity.title }}</text>\n              <text \n                :class=\"getStatusTextClass(activity)\"\n                class=\"text-xs font-semibold\">\n                {{ getDisplayStatus(activity) }}\n              </text>\n            </view>\n            \n            <text class=\"text-gray-500 text-sm mb-3\">{{ activity.description }}</text>\n            \n            <view class=\"flex items-center justify-between text-xs\">\n              <view class=\"flex items-center\">\n                <image src=\"/static/images/icons/icon-location.svg\" class=\"icon-small mr-1\"></image>\n                <text>{{ activity.location }}</text>\n              </view>\n              <view class=\"flex items-center\">\n                <image src=\"/static/images/icons/icon-calendar.svg\" class=\"icon-small mr-1\"></image>\n                <text>{{ activity.activity_time }}</text>\n              </view>\n            </view>\n            \n            <view class=\"mt-3 flex items-center\">\n              <text class=\"text-xs text-gray-500\">{{ getParticipantsText(activity) }}</text>\n              <button \n                :class=\"getActionButtonClass(activity)\"\n                @tap=\"handleActivityAction(activity)\">\n                {{ getActionButtonText(activity) }}\n              </button>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue';\nimport { getActivities, enrollActivity } from '../../services/userActivity.js';\n\n// 活动列表\nconst activities = ref([]);\nconst loading = ref(true);\n\n// 获取活动列表\nconst loadActivities = async () => {\n  loading.value = true;\n  try {\n    const result = await getActivities();\n    activities.value = result;\n  } catch (error) {\n    uni.showToast({\n      title: error.message || '获取活动列表失败',\n      icon: 'none'\n    });\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 获取状态文本样式类\nconst getStatusTextClass = (activity) => {\n  if (activity.isCheckedIn) {\n    return 'text-gray-500'; // 已完成打卡，显示灰色\n  } else if (activity.isEnrolled) {\n    return 'text-green-500'; // 已报名但未打卡，显示绿色\n  }\n  \n  switch (activity.status) {\n    case '报名中':\n      return 'text-yellow-500'; // 报名中，显示橙色\n    case '未开始':\n      return 'text-blue-500'; // 未开始，显示蓝色\n    case '已结束':\n      return 'text-gray-500'; // 已结束，显示灰色\n    default:\n      return 'text-gray-500';\n  }\n};\n\n// 获取用户端显示的状态文本\nconst getDisplayStatus = (activity) => {\n  if (activity.isCheckedIn) {\n    return '已完成'; // 已完成打卡\n  } else if (activity.isEnrolled) {\n    return '进行中'; // 已报名但未打卡\n  }\n  \n  return activity.status; // 否则显示原始状态\n};\n\n// 获取参与人数文本\nconst getParticipantsText = (activity) => {\n  return activity.isEnrolled ? '2人已报名' : '2人已报名';\n};\n\n// 获取操作按钮文本\nconst getActionButtonText = (activity) => {\n  if (activity.isCheckedIn) {\n    return '已完成';\n  } else if (activity.isEnrolled) {\n    return '查看详情';\n  } else if (activity.status === '未开始') {\n    return '等待开始';\n  } else if (activity.status === '已结束') {\n    return '已结束';\n  } else {\n    return '立即报名';\n  }\n};\n\n// 获取按钮样式类\nconst getActionButtonClass = (activity) => {\n  if (activity.status === '未开始' || activity.status === '已结束') {\n    return 'ml-auto bg-gray-200 text-gray-500 text-sm px-4 py-1 rounded-full';\n  } else {\n    return 'ml-auto bg-green-50 text-green-600 text-sm px-4 py-1 rounded-full';\n  }\n};\n\n// 处理活动操作\nconst handleActivityAction = (activity) => {\n  if (activity.isCheckedIn) {\n    // 已完成，不做任何操作\n    uni.showToast({\n      title: '您已完成该活动',\n      icon: 'none'\n    });\n  } else if (activity.isEnrolled) {\n    // 已报名但未完成，跳转到详情页\n    navigateToDetail(activity._id);\n  } else if (activity.status === '未开始') {\n    // 未开始，提示用户\n    uni.showToast({\n      title: '活动尚未开始，请等待',\n      icon: 'none'\n    });\n  } else if (activity.status === '已结束') {\n    // 已结束，提示用户\n    uni.showToast({\n      title: '该活动已结束',\n      icon: 'none'\n    });\n  } else {\n    // 未报名，弹窗确认报名\n    confirmEnroll(activity);\n  }\n};\n\n// 确认报名\nconst confirmEnroll = (activity) => {\n  uni.showModal({\n    title: '报名确认',\n    content: `确定要报名参加\"${activity.title}\"活动吗？`,\n    success: async (res) => {\n      if (res.confirm) {\n        try {\n          uni.showLoading({ title: '报名中...' });\n          await enrollActivity(activity._id);\n          uni.hideLoading();\n          \n          uni.showToast({\n            title: '报名成功',\n            icon: 'success'\n          });\n          \n          // 重新加载活动列表\n          await loadActivities();\n        } catch (error) {\n          uni.hideLoading();\n          uni.showToast({\n            title: error.message || '报名失败',\n            icon: 'none'\n          });\n        }\n      }\n    }\n  });\n};\n\n// 跳转到活动详情\nconst navigateToDetail = (activityId) => {\n  uni.navigateTo({\n    url: `/pages/home/activity-detail?id=${activityId}`\n  });\n};\n\n// 页面加载\nonMounted(() => {\n  loadActivities();\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.header {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n}\n\n.empty-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 200px;\n}\n\n.empty-text {\n  color: #9ca3af;\n}\n\n.card {\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n}\n\n/* 加载圈样式 */\n.loading-circle {\n  width: 30px;\n  height: 30px;\n  border: 3px solid rgba(76, 175, 80, 0.2);\n  border-top: 3px solid #4CAF50;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n/* 工具类 */\n.bg-white { background-color: #ffffff; }\n.text-green-500 { color: #4CAF50; }\n.text-green-600 { color: #3d9140; }\n.text-yellow-500 { color: #f59e0b; }\n.text-blue-500 { color: #3b82f6; }\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-600 { color: #4b5563; }\n.text-gray-900 { color: #111827; }\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.text-xs { font-size: 12px; }\n.font-medium { font-weight: 500; }\n.font-semibold { font-weight: 600; }\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n.justify-between { justify-content: space-between; }\n.text-center { text-align: center; }\n.w-12 { width: 48px; }\n.h-12 { height: 48px; }\n.w-24px { width: 24px; }\n.p-3 { padding: 12px; }\n.p-4 { padding: 16px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-1 { padding-top: 4px; padding-bottom: 4px; }\n.py-10 { padding-top: 40px; padding-bottom: 40px; }\n.pt-10 { padding-top: 40px; }\n.pb-3 { padding-bottom: 12px; }\n.mb-4 { margin-bottom: 16px; }\n.mb-3 { margin-bottom: 12px; }\n.mb-2 { margin-bottom: 8px; }\n.mr-1 { margin-right: 4px; }\n.ml-auto { margin-left: auto; }\n.mt-3 { margin-top: 12px; }\n.rounded-full { border-radius: 9999px; }\n.bg-green-50 { background-color: #e8f5e9; }\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n\n.icon-small {\n  width: 14px;\n  height: 14px;\n}\n\n.more-btn {\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.more-icon {\n  width: 20px;\n  height: 20px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/home/activity-list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getActivities","uni","enrollActivity","onMounted","MiniProgramPage"],"mappings":"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"}