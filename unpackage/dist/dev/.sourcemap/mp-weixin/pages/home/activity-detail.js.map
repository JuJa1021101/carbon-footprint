{"version":3,"file":"activity-detail.js","sources":["pages/home/activity-detail.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9hY3Rpdml0eS1kZXRhaWwudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-white px-4 pt-10 pb-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <image src=\"/static/images/icons/icon-back.svg\" class=\"back-icon\"></image>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-gray-900 text-lg font-medium\">活动详情</text>\n        </view>\n        <view class=\"more-btn\">\n          <image src=\"/static/images/icons/icon-more.svg\" class=\"more-icon\"></image>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"flex justify-center py-10\">\n      <view class=\"loading-circle\"></view>\n    </view>\n    \n    <!-- 内容区 -->\n    <view v-else class=\"p-4\">\n      <view v-if=\"activity\" class=\"detail-card bg-white rounded-lg shadow-sm\">\n        <!-- 活动标题 -->\n        <view class=\"p-4 border-b\">\n          <view class=\"flex justify-between items-center mb-2\">\n            <text class=\"text-lg font-medium\">{{ activity.title }}</text>\n            <text \n              :class=\"getStatusTextClass(activity)\"\n              class=\"text-xs font-semibold\">\n              {{ getDisplayStatus(activity) }}\n            </text>\n          </view>\n        </view>\n        \n        <!-- 活动信息 -->\n        <view class=\"p-4\">\n          <view class=\"mb-4\">\n            <text class=\"text-gray-700 mb-2 block\">活动介绍</text>\n            <text class=\"text-gray-600 text-sm leading-relaxed\">{{ activity.description }}</text>\n          </view>\n          \n          <view class=\"info-row mb-3 flex items-center\">\n            <image src=\"/static/images/icons/icon-location.svg\" class=\"info-icon mr-2\"></image>\n            <text class=\"text-gray-600\">{{ activity.location }}</text>\n          </view>\n          \n          <view class=\"info-row mb-3 flex items-center\">\n            <image src=\"/static/images/icons/icon-calendar.svg\" class=\"info-icon mr-2\"></image>\n            <text class=\"text-gray-600\">{{ activity.activity_time }}</text>\n          </view>\n          \n          <view class=\"info-row mb-3 flex items-center\">\n            <image src=\"/static/images/icons/icon-like.svg\" class=\"info-icon mr-2\"></image>\n            <text class=\"text-gray-600\">完成打卡可获得 {{ activity.point }} 积分</text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 找不到活动 -->\n      <view v-else class=\"flex justify-center py-10\">\n        <text class=\"text-gray-500\">未找到该活动信息</text>\n      </view>\n    </view>\n    \n    <!-- 打卡按钮 -->\n    <view \n      v-if=\"activity && activity.isEnrolled && !activity.isCheckedIn\"\n      class=\"checkin-btn\" \n      @tap=\"handleCheckIn\">\n      <text class=\"text-white text-xl\">打卡</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { getActivities, checkInActivity } from '../../services/userActivity.js';\n\n// 活动ID\nconst activityId = ref('');\n// 活动信息\nconst activity = ref(null);\nconst loading = ref(true);\n\n// 获取活动详情\nconst loadActivityDetail = async (id) => {\n  loading.value = true;\n  try {\n    const activities = await getActivities(false); // 不排序\n    const found = activities.find(item => item._id === id);\n    \n    if (found) {\n      activity.value = found;\n    } else {\n      uni.showToast({\n        title: '未找到活动信息',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    uni.showToast({\n      title: error.message || '获取活动信息失败',\n      icon: 'none'\n    });\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 获取状态文本样式类\nconst getStatusTextClass = (activity) => {\n  if (activity.isCheckedIn) {\n    return 'text-gray-500'; // 已完成打卡，显示灰色\n  } else if (activity.isEnrolled) {\n    return 'text-green-500'; // 已报名但未打卡，显示绿色\n  }\n  \n  switch (activity.status) {\n    case '报名中':\n      return 'text-yellow-500'; // 报名中，显示橙色\n    case '未开始':\n      return 'text-blue-500'; // 未开始，显示蓝色\n    case '已结束':\n      return 'text-gray-500'; // 已结束，显示灰色\n    default:\n      return 'text-gray-500';\n  }\n};\n\n// 获取用户端显示的状态文本\nconst getDisplayStatus = (activity) => {\n  if (activity.isCheckedIn) {\n    return '已完成'; // 已完成打卡\n  } else if (activity.isEnrolled) {\n    return '进行中'; // 已报名但未打卡\n  }\n  \n  return activity.status; // 否则显示原始状态\n};\n\n// 处理打卡\nconst handleCheckIn = () => {\n  if (!activity.value) return;\n  \n  uni.showModal({\n    title: '打卡确认',\n    content: `确定要为\"${activity.value.title}\"活动打卡吗？完成后将获得${activity.value.point}积分`,\n    success: async (res) => {\n      if (res.confirm) {\n        try {\n          uni.showLoading({ title: '打卡中...' });\n          const result = await checkInActivity(activity.value._id, activity.value.point);\n          uni.hideLoading();\n          \n          uni.showToast({\n            title: `打卡成功，获得${result.points}积分`,\n            icon: 'success'\n          });\n          \n          // 重新加载活动信息\n          await loadActivityDetail(activityId.value);\n          \n          // 延时返回\n          setTimeout(() => {\n            uni.navigateBack();\n          }, 1500);\n        } catch (error) {\n          uni.hideLoading();\n          uni.showToast({\n            title: error.message || '打卡失败',\n            icon: 'none'\n          });\n        }\n      }\n    }\n  });\n};\n\n// 页面加载\nonMounted(() => {\n  // 获取页面参数\n  const page = getCurrentPages().pop();\n  const options = page.options || {};\n  \n  if (options.id) {\n    activityId.value = options.id;\n    loadActivityDetail(options.id);\n  } else {\n    uni.showToast({\n      title: '缺少活动ID',\n      icon: 'none'\n    });\n    setTimeout(() => {\n      uni.navigateBack();\n    }, 1500);\n  }\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.header {\n  box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n}\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n\n.info-icon {\n  width: 16px;\n  height: 16px;\n}\n\n.info-row {\n  display: flex;\n  align-items: center;\n}\n\n.leading-relaxed {\n  line-height: 1.6;\n}\n\n.checkin-btn {\n  position: fixed;\n  bottom: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #4CAF50 0%, #3d8c40 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 4px 16px rgba(76, 175, 80, 0.4);\n}\n\n.loading-circle {\n  width: 40px;\n  height: 40px;\n  border: 3px solid #f0f0f0;\n  border-radius: 50%;\n  border-top-color: #4CAF50;\n  animation: spin 1s infinite linear;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n.more-btn {\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.more-icon {\n  width: 20px;\n  height: 20px;\n}\n\n/* 工具类 */\n.bg-white { background-color: #ffffff; }\n.text-green-500 { color: #4CAF50; }\n.text-yellow-500 { color: #f59e0b; }\n.text-blue-500 { color: #3b82f6; }\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-600 { color: #4b5563; }\n.text-gray-700 { color: #374151; }\n.text-gray-900 { color: #111827; }\n.text-white { color: #ffffff; }\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.text-xs { font-size: 12px; }\n.text-xl { font-size: 20px; }\n.font-medium { font-weight: 500; }\n.font-semibold { font-weight: 600; }\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n.justify-between { justify-content: space-between; }\n.text-center { text-align: center; }\n.w-12 { width: 48px; }\n.h-12 { height: 48px; }\n.w-24px { width: 24px; }\n.p-3 { padding: 12px; }\n.p-4 { padding: 16px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-10 { padding-top: 40px; padding-bottom: 40px; }\n.pt-10 { padding-top: 40px; }\n.pb-3 { padding-bottom: 12px; }\n.mb-4 { margin-bottom: 16px; }\n.mb-3 { margin-bottom: 12px; }\n.mb-2 { margin-bottom: 8px; }\n.mr-2 { margin-right: 8px; }\n.rounded-lg { border-radius: 8px; }\n.border-b { border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #e5e7eb; }\n.shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/home/activity-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getActivities","uni","activity","checkInActivity","onMounted","MiniProgramPage"],"mappings":";;;;;;;AAkFA,UAAM,aAAaA,cAAAA,IAAI,EAAE;AAEzB,UAAM,WAAWA,cAAAA,IAAI,IAAI;AACzB,UAAM,UAAUA,cAAAA,IAAI,IAAI;AAGxB,UAAM,qBAAqB,OAAO,OAAO;AACvC,cAAQ,QAAQ;AAChB,UAAI;AACF,cAAM,aAAa,MAAMC,oCAAc,KAAK;AAC5C,cAAM,QAAQ,WAAW,KAAK,UAAQ,KAAK,QAAQ,EAAE;AAErD,YAAI,OAAO;AACT,mBAAS,QAAQ;AAAA,QACvB,OAAW;AACLC,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,MAAM,WAAW;AAAA,UACxB,MAAM;AAAA,QACZ,CAAK;AAAA,MACL,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,SAAS,MAAM;AACnBA,oBAAG,MAAC,aAAY;AAAA,IAClB;AAGA,UAAM,qBAAqB,CAACC,cAAa;AACvC,UAAIA,UAAS,aAAa;AACxB,eAAO;AAAA,MACX,WAAaA,UAAS,YAAY;AAC9B,eAAO;AAAA,MACR;AAED,cAAQA,UAAS,QAAM;AAAA,QACrB,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AACH,iBAAO;AAAA,QACT;AACE,iBAAO;AAAA,MACV;AAAA,IACH;AAGA,UAAM,mBAAmB,CAACA,cAAa;AACrC,UAAIA,UAAS,aAAa;AACxB,eAAO;AAAA,MACX,WAAaA,UAAS,YAAY;AAC9B,eAAO;AAAA,MACR;AAED,aAAOA,UAAS;AAAA,IAClB;AAGA,UAAM,gBAAgB,MAAM;AAC1B,UAAI,CAAC,SAAS;AAAO;AAErBD,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,QAAQ,SAAS,MAAM,KAAK,gBAAgB,SAAS,MAAM,KAAK;AAAA,QACzE,SAAS,OAAO,QAAQ;AACtB,cAAI,IAAI,SAAS;AACf,gBAAI;AACFA,4BAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AACnC,oBAAM,SAAS,MAAME,sBAAe,gBAAC,SAAS,MAAM,KAAK,SAAS,MAAM,KAAK;AAC7EF,4BAAG,MAAC,YAAW;AAEfA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO,UAAU,OAAO,MAAM;AAAA,gBAC9B,MAAM;AAAA,cAClB,CAAW;AAGD,oBAAM,mBAAmB,WAAW,KAAK;AAGzC,yBAAW,MAAM;AACfA,8BAAG,MAAC,aAAY;AAAA,cACjB,GAAE,IAAI;AAAA,YACR,SAAQ,OAAO;AACdA,4BAAG,MAAC,YAAW;AACfA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO,MAAM,WAAW;AAAA,gBACxB,MAAM;AAAA,cAClB,CAAW;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGAG,kBAAAA,UAAU,MAAM;AAEd,YAAM,OAAO,kBAAkB;AAC/B,YAAM,UAAU,KAAK,WAAW;AAEhC,UAAI,QAAQ,IAAI;AACd,mBAAW,QAAQ,QAAQ;AAC3B,2BAAmB,QAAQ,EAAE;AAAA,MACjC,OAAS;AACLH,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD,mBAAW,MAAM;AACfA,wBAAG,MAAC,aAAY;AAAA,QACjB,GAAE,IAAI;AAAA,MACR;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3MD,GAAG,WAAWI,SAAe;"}