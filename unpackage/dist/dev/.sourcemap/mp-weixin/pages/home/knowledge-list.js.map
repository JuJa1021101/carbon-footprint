{"version":3,"file":"knowledge-list.js","sources":["pages/home/knowledge-list.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9rbm93bGVkZ2UtbGlzdC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-green px-4 py-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <image src=\"/static/images/icons/icon-back.svg\" class=\"back-icon\"></image>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-white text-lg font-medium\">环保知识与小贴士</text>\n        </view>\n        <view class=\"more-btn\">\n          <image src=\"/static/images/icons/icon-more.svg\" class=\"more-icon\" style=\"filter: brightness(0) invert(1);\"></image>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"flex justify-center py-10\">\n      <image src=\"/static/images/loading.gif\" class=\"w-12 h-12\"></image>\n    </view>\n    \n    <!-- 错误提示 -->\n    <view v-else-if=\"hasError\" class=\"p-4\">\n      <view class=\"bg-white rounded-lg p-6 flex flex-col items-center\">\n        <text class=\"text-red-500 mb-2\">加载失败</text>\n        <text class=\"text-gray-500 text-sm text-center mb-4\">{{ errorMessage }}</text>\n        <button class=\"bg-green-500 text-white px-4 py-2 rounded-full text-sm\" @tap=\"getKnowledgeList\">\n          重新加载\n        </button>\n      </view>\n    </view>\n    \n    <!-- 知识列表 -->\n    <view v-else class=\"p-4\">\n      <view v-if=\"knowledgeList.length === 0\" class=\"bg-white rounded-lg p-6 flex justify-center\">\n        <text class=\"text-gray-500\">暂无环保知识，敬请期待</text>\n      </view>\n      \n      <view v-else class=\"knowledge-list\">\n        <view \n          v-for=\"(item, index) in knowledgeList\" \n          :key=\"item._id\" \n          class=\"knowledge-card bg-white mb-4 rounded-lg overflow-hidden\"\n          @tap=\"navigateToDetail(item._id)\">\n          <!-- 知识图片 -->\n          <image \n            v-if=\"item.image\" \n            :src=\"item.image\" \n            mode=\"aspectFill\" \n            class=\"knowledge-image w-full\"\n          ></image>\n          \n          <!-- 知识内容 -->\n          <view class=\"p-4\">\n            <!-- 标题 -->\n            <text class=\"text-lg font-bold mb-2 block\">{{ item.title }}</text>\n            \n            <!-- 标签 -->\n            <view class=\"flex flex-wrap mb-3\">\n              <text \n                v-for=\"(tag, tagIndex) in item.tags\" \n                :key=\"tagIndex\" \n                class=\"tag mr-2 mb-2\">\n                # {{ tag }}\n              </text>\n            </view>\n            \n            <!-- 互动统计 -->\n            <view class=\"flex justify-between items-center\">\n              <view class=\"flex items-center\">\n                <!-- 浏览量 -->\n                <view class=\"flex items-center mr-4\">\n                  <text class=\"iconfont icon-eye text-gray-400 mr-1\"></text>\n                  <text class=\"text-sm text-gray-500\">{{ item.views || 0 }}</text>\n                </view>\n                \n                <!-- 点赞 -->\n                <view \n                  class=\"flex items-center\"\n                  @tap.stop=\"toggleLike(item)\"\n                >\n                  <text \n                    class=\"iconfont mr-1\"\n                    :class=\"item.isLiked ? 'icon-like-fill text-red-500' : 'icon-like text-gray-400'\"\n                  ></text>\n                  <text class=\"text-sm\" :class=\"item.isLiked ? 'text-red-500' : 'text-gray-500'\">{{ item.likes || 0 }}</text>\n                </view>\n              </view>\n              \n              <!-- 创建时间 -->\n              <text class=\"text-xs text-gray-400\">{{ formatDate(item.created_at) }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue';\nimport { getKnowledgeList as fetchKnowledgeList, toggleLikeKnowledge } from '../../services/knowledge.js';\n\n// 数据\nconst knowledgeList = ref([]);\nconst loading = ref(true);\nconst hasError = ref(false);\nconst errorMessage = ref('');\nconst userLikedIds = ref([]); // 用户已点赞的知识ID，实际应存储在本地或与用户关联\n\n// 获取环保知识列表\nconst getKnowledgeList = async () => {\n  loading.value = true;\n  hasError.value = false;\n  \n  try {\n    const result = await fetchKnowledgeList();\n    \n    // 处理点赞状态\n    const userLikedIdsFromStorage = uni.getStorageSync('userLikedKnowledge') || [];\n    userLikedIds.value = userLikedIdsFromStorage;\n    \n    // 为每个知识项添加isLiked属性\n    result.forEach(item => {\n      item.isLiked = userLikedIds.value.includes(item._id);\n    });\n    \n    knowledgeList.value = result;\n  } catch (error) {\n    console.error('加载环保知识列表失败:', error);\n    hasError.value = true;\n    errorMessage.value = error.message || '加载环保知识列表失败';\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 格式化日期\nconst formatDate = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n};\n\n// 切换点赞状态\nconst toggleLike = async (item) => {\n  try {\n    const currentLiked = item.isLiked;\n    \n    // 立即更新UI\n    item.isLiked = !currentLiked;\n    item.likes = (item.likes || 0) + (currentLiked ? -1 : 1);\n    \n    // 更新本地存储的点赞状态\n    let likedIds = [...userLikedIds.value];\n    if (currentLiked) {\n      likedIds = likedIds.filter(id => id !== item._id);\n    } else {\n      likedIds.push(item._id);\n    }\n    userLikedIds.value = likedIds;\n    uni.setStorageSync('userLikedKnowledge', likedIds);\n    \n    // 调用服务端API\n    await toggleLikeKnowledge(item._id, !currentLiked);\n  } catch (error) {\n    console.error('更新点赞状态失败:', error);\n    // 恢复原状态\n    item.isLiked = !item.isLiked;\n    item.likes = (item.likes || 0) + (item.isLiked ? -1 : 1);\n    \n    uni.showToast({\n      title: '点赞失败，请稍后重试',\n      icon: 'none'\n    });\n  }\n};\n\n// 跳转到详情页\nconst navigateToDetail = (id) => {\n  uni.navigateTo({\n    url: `/pages/home/knowledge-detail?id=${id}`\n  });\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 初始化\nonMounted(() => {\n  getKnowledgeList();\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.header {\n  padding-top: 44px;\n  padding-bottom: 12px;\n  box-sizing: content-box;\n}\n\n.bg-green {\n  background-color: #4CAF50;\n}\n\n.w-24px {\n  width: 24px;\n}\n\n.knowledge-list {\n  display: flex;\n  flex-direction: column;\n}\n\n.knowledge-card {\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.knowledge-image {\n  height: 200px;\n  object-fit: cover;\n}\n\n.tag {\n  font-size: 12px;\n  color: #4CAF50;\n}\n\n/* 工具类 */\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.flex-wrap { flex-wrap: wrap; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n.justify-between { justify-content: space-between; }\n.text-center { text-align: center; }\n\n.text-white { color: #ffffff; }\n.text-red-500 { color: #ef4444; }\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n\n.bg-white { background-color: #ffffff; }\n.bg-red-500 { background-color: #ef4444; }\n.bg-green-500 { background-color: #4CAF50; }\n\n.text-xs { font-size: 12px; }\n.text-sm { font-size: 14px; }\n.text-lg { font-size: 18px; }\n.font-medium { font-weight: 500; }\n.font-bold { font-weight: 600; }\n\n.mb-2 { margin-bottom: 8px; }\n.mb-3 { margin-bottom: 12px; }\n.mb-4 { margin-bottom: 16px; }\n.mr-1 { margin-right: 4px; }\n.mr-2 { margin-right: 8px; }\n.mr-4 { margin-right: 16px; }\n\n.p-4 { padding: 16px; }\n.p-6 { padding: 24px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-2 { padding-top: 8px; padding-bottom: 8px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n.py-10 { padding-top: 40px; padding-bottom: 40px; }\n\n.w-full { width: 100%; }\n.w-12 { width: 48px; }\n.h-12 { height: 48px; }\n\n.rounded-lg { border-radius: 8px; }\n.rounded-full { border-radius: 9999px; }\n\n.overflow-hidden { overflow: hidden; }\n.block { display: block; }\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n\n.more-btn {\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.more-icon {\n  width: 20px;\n  height: 20px;\n  filter: brightness(0) invert(1); /* 将图标变为白色 */\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/home/knowledge-list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","fetchKnowledgeList","uni","toggleLikeKnowledge","onMounted","MiniProgramPage"],"mappings":";;;;;;;AAyGA,UAAM,gBAAgBA,cAAAA,IAAI,CAAA,CAAE;AAC5B,UAAM,UAAUA,cAAAA,IAAI,IAAI;AACxB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAC1B,UAAM,eAAeA,cAAAA,IAAI,EAAE;AAC3B,UAAM,eAAeA,cAAAA,IAAI,CAAA,CAAE;AAG3B,UAAM,mBAAmB,YAAY;AACnC,cAAQ,QAAQ;AAChB,eAAS,QAAQ;AAEjB,UAAI;AACF,cAAM,SAAS,MAAMC,mBAAAA;AAGrB,cAAM,0BAA0BC,cAAG,MAAC,eAAe,oBAAoB,KAAK,CAAA;AAC5E,qBAAa,QAAQ;AAGrB,eAAO,QAAQ,UAAQ;AACrB,eAAK,UAAU,aAAa,MAAM,SAAS,KAAK,GAAG;AAAA,QACzD,CAAK;AAED,sBAAc,QAAQ;AAAA,MACvB,SAAQ,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,wCAAA,eAAe,KAAK;AAClC,iBAAS,QAAQ;AACjB,qBAAa,QAAQ,MAAM,WAAW;AAAA,MAC1C,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,aAAa,CAAC,cAAc;AAChC,UAAI,CAAC;AAAW,eAAO;AAEvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,IACzH;AAGA,UAAM,aAAa,OAAO,SAAS;AACjC,UAAI;AACF,cAAM,eAAe,KAAK;AAG1B,aAAK,UAAU,CAAC;AAChB,aAAK,SAAS,KAAK,SAAS,MAAM,eAAe,KAAK;AAGtD,YAAI,WAAW,CAAC,GAAG,aAAa,KAAK;AACrC,YAAI,cAAc;AAChB,qBAAW,SAAS,OAAO,QAAM,OAAO,KAAK,GAAG;AAAA,QACtD,OAAW;AACL,mBAAS,KAAK,KAAK,GAAG;AAAA,QACvB;AACD,qBAAa,QAAQ;AACrBA,sBAAAA,MAAI,eAAe,sBAAsB,QAAQ;AAGjD,cAAMC,mBAAmB,oBAAC,KAAK,KAAK,CAAC,YAAY;AAAA,MAClD,SAAQ,OAAO;AACdD,sBAAA,MAAA,MAAA,SAAA,wCAAc,aAAa,KAAK;AAEhC,aAAK,UAAU,CAAC,KAAK;AACrB,aAAK,SAAS,KAAK,SAAS,MAAM,KAAK,UAAU,KAAK;AAEtDA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAGA,UAAM,mBAAmB,CAAC,OAAO;AAC/BA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,mCAAmC,EAAE;AAAA,MAC9C,CAAG;AAAA,IACH;AAGA,UAAM,SAAS,MAAM;AACnBA,oBAAG,MAAC,aAAY;AAAA,IAClB;AAGAE,kBAAAA,UAAU,MAAM;AACd;IACF,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClMD,GAAG,WAAWC,SAAe;"}