{"version":3,"file":"search-result.js","sources":["pages/home/search-result.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9zZWFyY2gtcmVzdWx0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"px-4 pt-10 pb-4 bg-white\">\n      <view class=\"flex items-center mb-4\">\n        <view class=\"flex items-center\" @tap=\"goBack\">\n          <text class=\"iconfont icon-left text-gray-500 mr-2\"></text>\n          <text class=\"text-lg font-semibold\">搜索结果</text>\n        </view>\n      </view>\n\n      <!-- 搜索框 -->\n      <view class=\"relative search-container\">\n        <view class=\"search-input-container\">\n          <input \n            type=\"text\" \n            v-model=\"keyword\"\n            class=\"search-bar w-full bg-gray-100 py-2 px-4 pr-10 text-sm\" \n            placeholder=\"搜索环保知识、活动...\"\n            confirm-type=\"search\"\n            @confirm=\"handleSearch\">\n          <text \n            v-if=\"keyword\" \n            class=\"iconfont icon-close-circle absolute right-10 top-2-5 text-gray-400\" \n            @tap=\"clearSearch\"></text>\n          <text class=\"iconfont icon-search absolute right-3 top-2-5 text-gray-400\" @tap=\"handleSearch\"></text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 加载中 -->\n    <view v-if=\"loading\" class=\"flex justify-center py-10\">\n      <view class=\"loading-circle\"></view>\n    </view>\n    \n    <!-- 无关键词 -->\n    <view v-else-if=\"!keyword\" class=\"flex flex-col items-center py-10 px-4\">\n      <text class=\"iconfont icon-search text-gray-300 text-5xl mb-4\"></text>\n      <text class=\"text-gray-500\">请输入搜索关键词</text>\n    </view>\n    \n    <!-- 搜索结果为空 -->\n    <view v-else-if=\"searchResults.length === 0\" class=\"flex flex-col items-center py-10 px-4\">\n      <text class=\"iconfont icon-search text-gray-300 text-5xl mb-4\"></text>\n      <text class=\"text-gray-500\">没有找到相关内容</text>\n      <text class=\"text-gray-400 text-sm mt-2\">换个关键词试试吧</text>\n    </view>\n    \n    <!-- 搜索结果列表 -->\n    <view v-else class=\"p-4\">\n      <view class=\"flex items-center mb-4\">\n        <text class=\"text-sm\">关键词: \"{{ keyword }}\"</text>\n        <text class=\"text-xs text-gray-500 ml-2\">(找到 {{ total }} 条结果)</text>\n      </view>\n      \n      <!-- 结果列表 -->\n      <view v-for=\"(item, index) in searchResults\" :key=\"item._id || index\" \n        class=\"search-result-card bg-white mb-4 rounded-lg\" \n        @tap=\"navigateToDetail(item)\">\n        \n        <!-- 知识卡片 -->\n        <template v-if=\"item.type === 'knowledge'\">\n          <view class=\"p-4\">\n            <!-- 类型标签 -->\n            <view class=\"flex items-center mb-2\">\n              <text class=\"knowledge-tag\">{{ item.typeText }}</text>\n              <text v-if=\"item.tags\" class=\"green-tag ml-2\"># {{ item.tags.split(',')[0] }}</text>\n            </view>\n            \n            <!-- 标题 -->\n            <text class=\"font-medium mb-2 block\">{{ item.title }}</text>\n            \n            <!-- 内容简介 -->\n            <text class=\"text-gray-600 text-sm mb-3 content-preview\">{{ item.content }}</text>\n            \n            <!-- 互动数据 -->\n            <view class=\"flex items-center text-gray-500 text-xs mb-2\">\n              <text class=\"iconfont icon-eye mr-1\"></text>\n              <text class=\"mr-3\">{{ item.views || 0 }}</text>\n              <text class=\"iconfont icon-like mr-1\"></text>\n              <text>{{ item.likes || 0 }}</text>\n              <text class=\"ml-auto\">{{ formatTime(item.createdAt) }}</text>\n            </view>\n            \n            <!-- 封面图 -->\n            <image v-if=\"item.cover\" :src=\"item.cover\" mode=\"aspectFill\" class=\"knowledge-image w-full\"></image>\n          </view>\n        </template>\n        \n        <!-- 活动卡片 -->\n        <template v-else-if=\"item.type === 'activity'\">\n          <view class=\"p-4\">\n            <!-- 类型标签和状态 -->\n            <view class=\"flex items-center justify-between mb-2\">\n              <text class=\"activity-tag\">{{ item.typeText }}</text>\n              <text :class=\"getStatusClass(item.status)\" class=\"status-tag\">{{ item.status }}</text>\n            </view>\n            \n            <!-- 标题 -->\n            <text class=\"font-medium mb-2 block\">{{ item.title }}</text>\n            \n            <!-- 内容简介 -->\n            <text class=\"text-gray-600 text-sm mb-3 content-preview\">{{ item.description }}</text>\n            \n            <!-- 地点 -->\n            <view class=\"flex items-center mb-2 text-gray-500 text-sm\">\n              <text class=\"iconfont icon-location mr-1\"></text>\n              <text>{{ item.location }}</text>\n            </view>\n            \n            <!-- 时间 -->\n            <view class=\"flex items-center mb-2 text-gray-500 text-sm\">\n              <text class=\"iconfont icon-calendar mr-1\"></text>\n              <text>{{ item.activity_time }}</text>\n            </view>\n            \n            <!-- 积分 -->\n            <view v-if=\"item.point\" class=\"point-badge\">\n              {{ item.point }} 积分\n            </view>\n          </view>\n        </template>\n        \n        <!-- 其他类型 -->\n        <template v-else>\n          <view class=\"p-4\">\n            <text class=\"font-medium mb-2 block\">{{ item.title }}</text>\n            <text class=\"text-gray-600 text-sm\">{{ item.content || item.description }}</text>\n          </view>\n        </template>\n      </view>\n      \n      <!-- 加载更多 -->\n      <view v-if=\"hasMore\" class=\"py-4 flex justify-center\">\n        <text class=\"text-green-500\" @tap=\"loadMore\">加载更多</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue';\nimport { searchContent } from '@/services/search.js';\n\n// 接收参数\nconst props = defineProps({\n  initialKeyword: {\n    type: String,\n    default: ''\n  }\n});\n\n// 页面数据\nconst keyword = ref(props.initialKeyword || '');\nconst searchResults = ref([]);\nconst loading = ref(false);\nconst currentPage = ref(1);\nconst pageSize = ref(10);\nconst total = ref(0);\nconst hasMore = ref(false);\n\n// 初始化搜索\nonMounted(() => {\n  if (keyword.value) {\n    handleSearch();\n  }\n  \n  // 获取页面参数\n  const pages = getCurrentPages();\n  const currentPage = pages[pages.length - 1];\n  const options = currentPage.options || {};\n  \n  if (options.keyword && !keyword.value) {\n    keyword.value = decodeURIComponent(options.keyword);\n    handleSearch();\n  }\n});\n\n// 处理搜索\nconst handleSearch = async () => {\n  if (!keyword.value.trim()) return;\n  \n  loading.value = true;\n  currentPage.value = 1;\n  searchResults.value = [];\n  \n  try {\n    const result = await searchContent(keyword.value, {\n      page: currentPage.value,\n      pageSize: pageSize.value\n    });\n    \n    searchResults.value = result.results || [];\n    total.value = result.total || 0;\n    hasMore.value = searchResults.value.length < total.value;\n  } catch (error) {\n    console.error('搜索失败', error);\n    uni.showToast({\n      title: error.message || '搜索失败',\n      icon: 'none'\n    });\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 加载更多\nconst loadMore = async () => {\n  if (loading.value || !hasMore.value) return;\n  \n  loading.value = true;\n  currentPage.value++;\n  \n  try {\n    const result = await searchContent(keyword.value, {\n      page: currentPage.value,\n      pageSize: pageSize.value\n    });\n    \n    if (result.results && result.results.length > 0) {\n      searchResults.value = [...searchResults.value, ...result.results];\n    }\n    \n    total.value = result.total || 0;\n    hasMore.value = searchResults.value.length < total.value;\n  } catch (error) {\n    console.error('加载更多失败', error);\n    currentPage.value--; // 恢复页数\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 清除搜索\nconst clearSearch = () => {\n  keyword.value = '';\n  searchResults.value = [];\n  total.value = 0;\n  currentPage.value = 1;\n  hasMore.value = false;\n};\n\n// 返回\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 导航到详情页\nconst navigateToDetail = (item) => {\n  if (item.type === 'knowledge') {\n    uni.navigateTo({\n      url: `/pages/home/knowledge-detail?id=${item._id}`\n    });\n  } else if (item.type === 'activity') {\n    uni.navigateTo({\n      url: `/pages/home/activity-detail?id=${item._id}`\n    });\n  }\n};\n\n// 获取状态样式类\nconst getStatusClass = (status) => {\n  switch (status) {\n    case '报名中':\n      return 'status-enrolling';\n    case '进行中':\n      return 'status-ongoing';\n    case '未开始':\n      return 'status-upcoming';\n    case '已结束':\n      return 'status-ended';\n    default:\n      return 'status-default';\n  }\n};\n\n// 格式化时间\nconst formatTime = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  const now = new Date();\n  const diff = now - date;\n  \n  // 一小时内\n  if (diff < 60 * 60 * 1000) {\n    const minutes = Math.floor(diff / (60 * 1000));\n    return `${minutes}分钟前`;\n  }\n  \n  // 24小时内\n  if (diff < 24 * 60 * 60 * 1000) {\n    const hours = Math.floor(diff / (60 * 60 * 1000));\n    return `${hours}小时前`;\n  }\n  \n  // 昨天\n  const yesterday = new Date(now);\n  yesterday.setDate(yesterday.getDate() - 1);\n  if (date.getDate() === yesterday.getDate()) {\n    return '昨天';\n  }\n  \n  // 今年内\n  if (date.getFullYear() === now.getFullYear()) {\n    return `${date.getMonth() + 1}月${date.getDate()}日`;\n  }\n  \n  // 其他\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n};\n</script>\n\n<style>\n.container {\n  background-color: #f8f9fa;\n  font-family: \"PingFang SC\", \"Helvetica Neue\", Arial, sans-serif;\n  color: #333;\n  padding-bottom: 80px;\n  min-height: 100vh;\n}\n\n.search-bar {\n  border-radius: 20px;\n}\n\n.search-result-card {\n  box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n  overflow: hidden;\n}\n\n.knowledge-tag {\n  background-color: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n  border-radius: 12px;\n  padding: 2px 10px;\n  font-size: 12px;\n}\n\n.activity-tag {\n  background-color: rgba(76, 175, 80, 0.1);\n  color: #4CAF50;\n  border-radius: 12px;\n  padding: 2px 10px;\n  font-size: 12px;\n}\n\n.green-tag {\n  background-color: rgba(76, 175, 80, 0.1);\n  color: #4CAF50;\n  border-radius: 12px;\n  padding: 2px 10px;\n  font-size: 12px;\n}\n\n.status-tag {\n  font-size: 12px;\n  font-weight: 600;\n  border-radius: 9999px;\n  padding: 2px 8px;\n}\n\n.status-enrolling {\n  color: #F59E0B;\n  background-color: rgba(245, 158, 11, 0.1);\n}\n\n.status-ongoing {\n  color: #4CAF50;\n  background-color: rgba(76, 175, 80, 0.1);\n}\n\n.status-upcoming {\n  color: #3b82f6;\n  background-color: rgba(59, 130, 246, 0.1);\n}\n\n.status-ended {\n  color: #6b7280;\n  background-color: rgba(107, 114, 128, 0.1);\n}\n\n.status-default {\n  color: #6b7280;\n  background-color: rgba(107, 114, 128, 0.1);\n}\n\n.point-badge {\n  display: inline-block;\n  background-color: #4CAF50;\n  color: white;\n  border-radius: 12px;\n  padding: 2px 10px;\n  font-size: 12px;\n}\n\n.knowledge-image {\n  height: 140px;\n  border-radius: 8px;\n  object-fit: cover;\n  margin-top: 8px;\n}\n\n.content-preview {\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* 加载圈样式 */\n.loading-circle {\n  width: 30px;\n  height: 30px;\n  border: 3px solid rgba(76, 175, 80, 0.2);\n  border-top: 3px solid #4CAF50;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/home/search-result.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","currentPage","searchContent","uni","MiniProgramPage"],"mappings":"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"}