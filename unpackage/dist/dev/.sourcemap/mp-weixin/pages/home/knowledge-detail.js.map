{"version":3,"file":"knowledge-detail.js","sources":["pages/home/knowledge-detail.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9rbm93bGVkZ2UtZGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header\">\n      <view class=\"nav-bar\">\n        <view class=\"back-btn\" @tap=\"goBack\">\n          <image src=\"/static/images/icons/icon-back.svg\" class=\"back-icon\"></image>\n        </view>\n        <view class=\"title\">环保知识详情</view>\n        <view class=\"more-btn\">\n          <image src=\"/static/images/icons/icon-more.svg\" class=\"more-icon\" style=\"filter: brightness(0) invert(1);\"></image>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"loading-container\">\n      <view class=\"loading-circle\"></view>\n    </view>\n    \n    <!-- 错误提示 -->\n    <view v-else-if=\"hasError\" class=\"error-container\">\n      <view class=\"error-box\">\n        <text class=\"error-text\">加载失败</text>\n        <text class=\"error-message\">{{ errorMessage }}</text>\n        <button class=\"retry-btn\" @tap=\"getKnowledgeDetail\">\n          重新加载\n        </button>\n      </view>\n    </view>\n    \n    <!-- 知识详情 -->\n    <view v-else class=\"knowledge-content\">\n      <!-- 标题 -->\n      <view class=\"title-section\">\n        <text class=\"knowledge-title\">{{ knowledge.title }}</text>\n      </view>\n      \n      <!-- 内容 -->\n      <view class=\"content-section\">\n        <view class=\"content-label\">\n          <text>环保知识：</text>\n        </view>\n        <rich-text :nodes=\"knowledge.content\" class=\"content-text\"></rich-text>\n      </view>\n      \n      <!-- 图片 -->\n      <view v-if=\"knowledge.image\" class=\"image-section\">\n        <image :src=\"knowledge.image\" mode=\"widthFix\" class=\"knowledge-image\"></image>\n      </view>\n      \n      <!-- 标签和时间 -->\n      <view class=\"tags-time-section\">\n        <view class=\"tags-container\" v-if=\"knowledge.tags && knowledge.tags.length > 0\">\n          <text \n            v-for=\"(tag, index) in knowledge.tags\" \n            :key=\"index\"\n            class=\"tag-pill\">\n            # {{ tag }}\n          </text>\n        </view>\n        <view class=\"time-container\">\n          <text class=\"time-text\">{{ formatDate(knowledge.created_at) }}</text>\n        </view>\n      </view>\n      \n      <!-- 底部数据栏 -->\n      <view class=\"stats-section\">\n        <view class=\"stats-container\">\n          <!-- 浏览量 -->\n          <view class=\"stat-item\">\n            <text class=\"iconfont icon-eye\"></text>\n            <text class=\"stat-value\">{{ knowledge.views || 0 }}</text>\n          </view>\n          \n          <!-- 点赞 -->\n          <view \n            class=\"stat-item\"\n            :class=\"{'liked': isLiked}\"\n            @tap=\"toggleLike\"\n          >\n            <text class=\"iconfont\" :class=\"isLiked ? 'icon-like-fill' : 'icon-like'\"></text>\n            <text class=\"stat-value\">{{ knowledge.likes || 0 }}</text>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport { getKnowledgeDetail as fetchKnowledgeDetail, toggleLikeKnowledge } from '../../services/knowledge.js';\n\n// 数据\nconst knowledgeId = ref('');\nconst knowledge = ref({});\nconst loading = ref(true);\nconst hasError = ref(false);\nconst errorMessage = ref('');\nconst isLiked = ref(false);\n\n// 获取知识详情\nconst getKnowledgeDetail = async () => {\n  if (!knowledgeId.value) return;\n  \n  loading.value = true;\n  hasError.value = false;\n  \n  try {\n    console.log('正在获取知识详情，ID:', knowledgeId.value);\n    const result = await fetchKnowledgeDetail(knowledgeId.value);\n    console.log('获取知识详情结果:', result);\n    \n    knowledge.value = result;\n    \n    // 检查是否已点赞\n    const userLikedIds = uni.getStorageSync('userLikedKnowledge') || [];\n    isLiked.value = userLikedIds.includes(knowledgeId.value);\n  } catch (error) {\n    console.error('加载环保知识详情失败:', error);\n    hasError.value = true;\n    errorMessage.value = error.message || '加载环保知识详情失败';\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 格式化日期\nconst formatDate = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n};\n\n// 切换点赞状态\nconst toggleLike = async () => {\n  try {\n    const currentLiked = isLiked.value;\n    \n    // 立即更新UI\n    isLiked.value = !currentLiked;\n    knowledge.value.likes = (knowledge.value.likes || 0) + (currentLiked ? -1 : 1);\n    \n    // 更新本地存储\n    const userLikedIds = uni.getStorageSync('userLikedKnowledge') || [];\n    let newLikedIds = [...userLikedIds];\n    \n    if (currentLiked) {\n      newLikedIds = newLikedIds.filter(id => id !== knowledgeId.value);\n    } else {\n      newLikedIds.push(knowledgeId.value);\n    }\n    \n    uni.setStorageSync('userLikedKnowledge', newLikedIds);\n    \n    // 调用服务端API\n    await toggleLikeKnowledge(knowledgeId.value, !currentLiked);\n  } catch (error) {\n    console.error('更新点赞状态失败:', error);\n    \n    // 恢复原状态\n    isLiked.value = !isLiked.value;\n    knowledge.value.likes = (knowledge.value.likes || 0) + (isLiked.value ? 1 : -1);\n    \n    uni.showToast({\n      title: '点赞失败，请稍后重试',\n      icon: 'none'\n    });\n  }\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack({\n    delta: 1,\n    fail: function() {\n      // 如果返回失败，跳转到环保知识列表页面\n      uni.navigateTo({\n        url: '/pages/home/knowledge-list'\n      });\n    }\n  });\n};\n\n// 初始化\nonLoad((options) => {\n  console.log('知识详情页面参数:', options);\n  if (options.id) {\n    knowledgeId.value = options.id;\n    getKnowledgeDetail();\n  } else {\n    hasError.value = true;\n    errorMessage.value = '缺少知识ID参数';\n    loading.value = false;\n  }\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  padding-bottom: 20px;\n  background-color: #f5f5f5;\n}\n\n.header {\n  background-color: #4CAF50;\n  padding: 44px 0 0;\n}\n\n.nav-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 16px;\n  height: 56px;\n}\n\n.back-btn {\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n}\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n\n.title {\n  color: #fff;\n  font-size: 18px;\n  font-weight: 500;\n  flex: 1;\n  text-align: center;\n}\n\n.more-btn {\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.more-icon {\n  width: 20px;\n  height: 20px;\n}\n\n/* 加载状态 */\n.loading-container {\n  display: flex;\n  justify-content: center;\n  padding: 40px 0;\n}\n\n.loading-circle {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  border: 3px solid #e5e7eb;\n  border-top-color: #4CAF50;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n/* 错误提示 */\n.error-container {\n  padding: 16px;\n}\n\n.error-box {\n  background-color: #fff;\n  border-radius: 8px;\n  padding: 24px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.error-text {\n  color: #ef4444;\n  margin-bottom: 8px;\n}\n\n.error-message {\n  color: #6b7280;\n  font-size: 14px;\n  text-align: center;\n  margin-bottom: 16px;\n}\n\n.retry-btn {\n  background-color: #4CAF50;\n  color: #fff;\n  padding: 8px 16px;\n  border-radius: 20px;\n  font-size: 14px;\n  border: none;\n}\n\n/* 知识内容 */\n.knowledge-content {\n  padding-bottom: 70px;\n}\n\n.title-section {\n  background-color: #fff;\n  padding: 16px;\n  margin-bottom: 1px;\n}\n\n.knowledge-title {\n  font-size: 18px;\n  font-weight: bold;\n  color: #333;\n  text-align: center;\n  display: block;\n}\n\n.content-section {\n  background-color: #fff;\n  padding: 16px;\n  margin-bottom: 10px;\n}\n\n.content-label {\n  font-size: 16px;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 12px;\n}\n\n.content-text {\n  font-size: 15px;\n  line-height: 1.6;\n  color: #333;\n}\n\n.image-section {\n  background-color: #fff;\n  padding: 16px;\n  margin-bottom: 10px;\n}\n\n.knowledge-image {\n  width: 100%;\n  border-radius: 8px;\n}\n\n.tags-time-section {\n  background-color: #fff;\n  padding: 16px;\n  margin-bottom: 10px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.tags-container {\n  display: flex;\n  flex-wrap: wrap;\n  flex: 1;\n}\n\n.tag-pill {\n  display: inline-block;\n  font-size: 12px;\n  color: #4CAF50;\n  background-color: #e8f5e9;\n  padding: 4px 12px;\n  border-radius: 16px;\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n\n.time-container {\n  margin-left: 10px;\n}\n\n.time-text {\n  font-size: 12px;\n  color: #999;\n}\n\n.stats-section {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: #fff;\n  border-top: 1px solid #eee;\n  padding: 12px 16px;\n}\n\n.stats-container {\n  display: flex;\n  justify-content: center;\n}\n\n.stat-item {\n  display: flex;\n  align-items: center;\n  margin: 0 20px;\n  color: #666;\n}\n\n.stat-item.liked {\n  color: #ff5252;\n}\n\n.stat-item .iconfont {\n  margin-right: 4px;\n  font-size: 20px;\n}\n\n.stat-value {\n  font-size: 14px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/home/knowledge-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","fetchKnowledgeDetail","toggleLikeKnowledge","onLoad","MiniProgramPage"],"mappings":";;;;;;;AAgGA,UAAM,cAAcA,cAAAA,IAAI,EAAE;AAC1B,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AACxB,UAAM,UAAUA,cAAAA,IAAI,IAAI;AACxB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAC1B,UAAM,eAAeA,cAAAA,IAAI,EAAE;AAC3B,UAAM,UAAUA,cAAAA,IAAI,KAAK;AAGzB,UAAM,qBAAqB,YAAY;AACrC,UAAI,CAAC,YAAY;AAAO;AAExB,cAAQ,QAAQ;AAChB,eAAS,QAAQ;AAEjB,UAAI;AACFC,sBAAY,MAAA,MAAA,OAAA,0CAAA,gBAAgB,YAAY,KAAK;AAC7C,cAAM,SAAS,MAAMC,mBAAAA,mBAAqB,YAAY,KAAK;AAC3DD,sBAAY,MAAA,MAAA,OAAA,0CAAA,aAAa,MAAM;AAE/B,kBAAU,QAAQ;AAGlB,cAAM,eAAeA,cAAG,MAAC,eAAe,oBAAoB,KAAK,CAAA;AACjE,gBAAQ,QAAQ,aAAa,SAAS,YAAY,KAAK;AAAA,MACxD,SAAQ,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,0CAAA,eAAe,KAAK;AAClC,iBAAS,QAAQ;AACjB,qBAAa,QAAQ,MAAM,WAAW;AAAA,MAC1C,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,aAAa,CAAC,cAAc;AAChC,UAAI,CAAC;AAAW,eAAO;AAEvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,IACzH;AAGA,UAAM,aAAa,YAAY;AAC7B,UAAI;AACF,cAAM,eAAe,QAAQ;AAG7B,gBAAQ,QAAQ,CAAC;AACjB,kBAAU,MAAM,SAAS,UAAU,MAAM,SAAS,MAAM,eAAe,KAAK;AAG5E,cAAM,eAAeA,cAAG,MAAC,eAAe,oBAAoB,KAAK,CAAA;AACjE,YAAI,cAAc,CAAC,GAAG,YAAY;AAElC,YAAI,cAAc;AAChB,wBAAc,YAAY,OAAO,QAAM,OAAO,YAAY,KAAK;AAAA,QACrE,OAAW;AACL,sBAAY,KAAK,YAAY,KAAK;AAAA,QACnC;AAEDA,sBAAAA,MAAI,eAAe,sBAAsB,WAAW;AAGpD,cAAME,mBAAmB,oBAAC,YAAY,OAAO,CAAC,YAAY;AAAA,MAC3D,SAAQ,OAAO;AACdF,sBAAA,MAAA,MAAA,SAAA,0CAAc,aAAa,KAAK;AAGhC,gBAAQ,QAAQ,CAAC,QAAQ;AACzB,kBAAU,MAAM,SAAS,UAAU,MAAM,SAAS,MAAM,QAAQ,QAAQ,IAAI;AAE5EA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAGA,UAAM,SAAS,MAAM;AACnBA,oBAAAA,MAAI,aAAa;AAAA,QACf,OAAO;AAAA,QACP,MAAM,WAAW;AAEfA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,UACb,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGAG,kBAAM,OAAC,CAAC,YAAY;AAClBH,iFAAY,aAAa,OAAO;AAChC,UAAI,QAAQ,IAAI;AACd,oBAAY,QAAQ,QAAQ;AAC5B;MACJ,OAAS;AACL,iBAAS,QAAQ;AACjB,qBAAa,QAAQ;AACrB,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrMD,GAAG,WAAWI,SAAe;"}