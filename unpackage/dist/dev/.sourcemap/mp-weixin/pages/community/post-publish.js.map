{"version":3,"file":"post-publish.js","sources":["pages/community/post-publish.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tbXVuaXR5L3Bvc3QtcHVibGlzaC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-white px-4 pt-10 pb-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\" class=\"p-2\">\n          <IconImage name=\"back\" :size=\"18\" />\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-gray-900 text-lg font-medium\">发布动态</text>\n        </view>\n        <view>\n          <button \n            class=\"publish-btn text-white text-sm bg-green-500 rounded-full px-4 py-1\"\n            :disabled=\"!canPublish\"\n            :class=\"{'bg-gray-300': !canPublish}\"\n            @tap=\"publishPost\">\n            发布\n          </button>\n        </view>\n      </view>\n    </view>\n\n    <!-- 内容区 -->\n    <view class=\"p-4\">\n      <!-- 文本内容 -->\n      <textarea \n        v-model=\"content\" \n        class=\"w-full p-3 bg-white rounded-lg mb-4\" \n        placeholder=\"分享你的环保经验和心得...\" \n        maxlength=\"1000\"\n        auto-height>\n      </textarea>\n      \n      <!-- 图片上传 -->\n      <view class=\"image-upload bg-white rounded-lg p-4 mb-4\">\n        <view class=\"flex flex-wrap\">\n          <!-- 已上传的图片 -->\n          <view \n            v-for=\"(img, index) in images\" \n            :key=\"index\" \n            class=\"image-item relative m-1\">\n            <image \n              :src=\"img\" \n              class=\"w-full h-full object-cover\" \n              mode=\"aspectFill\">\n            </image>\n            <view \n              class=\"delete-btn\" \n              @tap.stop=\"removeImage(index)\">\n              <IconImage name=\"close-circle\" :size=\"12\" />\n            </view>\n          </view>\n          \n          <!-- 添加图片按钮 -->\n          <view \n            class=\"image-add-btn m-1\" \n            @tap=\"chooseImage\" \n            v-if=\"images.length < 9\">\n            <IconImage name=\"plus\" :size=\"24\" class=\"text-gray-400\" />\n            <text class=\"text-xs text-gray-400 mt-1\">{{ images.length }}/9</text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 标签选择 -->\n      <view class=\"bg-white rounded-lg p-4\">\n        <view class=\"flex items-center pb-3 border-b\">\n          <text class=\"text-gray-700\">添加标签</text>\n          <text class=\"text-xs text-gray-500 ml-2\">(推荐选择相关标签，便于内容被发现)</text>\n        </view>\n        \n        <!-- 已选标签 -->\n        <view class=\"flex flex-wrap mt-3 mb-2\" v-if=\"selectedTags.length > 0\">\n          <view \n            v-for=\"(tag, index) in selectedTags\" \n            :key=\"index\"\n            class=\"tag-item flex items-center bg-green-50 text-green-500 rounded-full px-3 py-1 mr-2 mb-2\">\n            <text class=\"text-sm\"># {{ tag }}</text>\n            <view class=\"ml-1\" @tap=\"removeTag(index)\">\n              <IconImage name=\"close-circle\" :size=\"12\" />\n            </view>\n          </view>\n        </view>\n        \n        <!-- 添加自定义标签 -->\n        <view class=\"flex mt-2\">\n          <input \n            type=\"text\" \n            v-model=\"customTag\" \n            class=\"flex-1 bg-gray-100 rounded-full px-4 py-2 text-sm\" \n            placeholder=\"输入自定义标签...\"\n            maxlength=\"20\"\n            @confirm=\"addCustomTag\" />\n          <button \n            class=\"ml-2 px-3 py-1 bg-green-500 text-white rounded-full text-sm\"\n            @tap=\"addCustomTag\">\n            添加\n          </button>\n        </view>\n        \n        <!-- 热门标签 -->\n        <view class=\"mt-4\">\n          <text class=\"text-sm text-gray-700 mb-2 block\">热门标签</text>\n          <view class=\"flex flex-wrap\">\n            <view \n              v-for=\"(tag, index) in popularTags\" \n              :key=\"index\"\n              class=\"tag-item bg-gray-100 text-gray-600 rounded-full px-3 py-1 mr-2 mb-2\"\n              :class=\"{ 'bg-green-50 text-green-500': isTagSelected(tag) }\"\n              @tap=\"toggleTag(tag)\">\n              <text class=\"text-sm\"># {{ tag }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue';\nimport { createPost } from '../../services/community.js';\nimport { getCurrentUser } from '../../services/login.js';\nimport IconImage from '../../components/IconImage.vue';\n\n// 帖子内容\nconst content = ref('');\nconst images = ref([]);\nconst customTag = ref('');\nconst selectedTags = ref([]);\n\n// 热门标签\nconst popularTags = ref([\n  '垃圾分类', '环保行动', '节约用水', '低碳生活', \n  '废物利用', '创意改造', '环保科普', '绿色出行',\n  '减塑行动', '二手交易', '能源节约', '植树造林'\n]);\n\n// 是否可以发布\nconst canPublish = computed(() => {\n  return content.value.trim().length > 0;\n});\n\n// 检查标签是否已选中\nconst isTagSelected = (tag) => {\n  return selectedTags.value.includes(tag);\n};\n\n// 切换标签选择状态\nconst toggleTag = (tag) => {\n  const index = selectedTags.value.indexOf(tag);\n  if (index > -1) {\n    selectedTags.value.splice(index, 1);\n  } else {\n    // 最多选择5个标签\n    if (selectedTags.value.length >= 5) {\n      uni.showToast({\n        title: '最多可选5个标签',\n        icon: 'none'\n      });\n      return;\n    }\n    selectedTags.value.push(tag);\n  }\n};\n\n// 移除已选标签\nconst removeTag = (index) => {\n  selectedTags.value.splice(index, 1);\n};\n\n// 添加自定义标签\nconst addCustomTag = () => {\n  const tag = customTag.value.trim();\n  \n  if (!tag) {\n    uni.showToast({\n      title: '标签不能为空',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  // 最多选择5个标签\n  if (selectedTags.value.length >= 5) {\n    uni.showToast({\n      title: '最多可选5个标签',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  // 避免重复添加\n  if (isTagSelected(tag)) {\n    uni.showToast({\n      title: '该标签已添加',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  selectedTags.value.push(tag);\n  customTag.value = '';\n};\n\n// 选择图片\nconst chooseImage = () => {\n  if (images.value.length >= 9) {\n    uni.showToast({\n      title: '最多上传9张图片',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  uni.chooseImage({\n    count: 9 - images.value.length,\n    sizeType: ['compressed'],\n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      // 模拟上传，实际开发中需要调用上传API\n      images.value = [...images.value, ...res.tempFilePaths];\n    }\n  });\n};\n\n// 移除图片\nconst removeImage = (index) => {\n  images.value.splice(index, 1);\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.showModal({\n    title: '提示',\n    content: '是否放弃发布？',\n    success: (res) => {\n      if (res.confirm) {\n        uni.navigateBack();\n      }\n    }\n  });\n};\n\n// 发布帖子\nconst publishPost = async () => {\n  // 验证内容\n  if (!content.value.trim()) {\n    uni.showToast({\n      title: '请输入内容',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  try {\n    const postData = {\n      content: content.value,\n      images: images.value,\n      label: selectedTags.value.join(',')\n    };\n    \n    const result = await createPost(postData);\n    uni.showToast({\n      title: '发布成功',\n      icon: 'success'\n    });\n    \n    // 通知社区页面刷新列表 - 使用更安全的方式\n    try {\n      // 获取当前页面栈\n      const pages = getCurrentPages();\n      // 获取上一页实例（社区页）\n      const prePage = pages[pages.length - 2];\n      // 直接调用上一页的方法刷新列表\n      if (prePage && prePage.$vm && typeof prePage.$vm.loadPosts === 'function') {\n        prePage.$vm.loadPosts();\n      }\n    } catch (e) {\n      console.error('通知刷新失败', e);\n    }\n    \n    // 延时返回，让用户看到发布成功提示\n    setTimeout(() => {\n      uni.navigateBack();\n    }, 1500);\n  } catch (error) {\n    uni.showToast({\n      title: error.message || '发布失败',\n      icon: 'none'\n    });\n  }\n};\n\n// 页面加载\nonMounted(() => {\n  console.log('发布页面加载');\n});\n</script>\n\n<style>\n.container {\n  background-color: #f8f9fa;\n  min-height: 100vh;\n}\n\n.header {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n\n.publish-btn {\n  border: none;\n  min-width: 70px;\n  line-height: 1.8;\n}\n\n.image-item {\n  width: 80px;\n  height: 80px;\n  overflow: hidden;\n  border-radius: 8px;\n}\n\n.image-add-btn {\n  width: 80px;\n  height: 80px;\n  border-radius: 8px;\n  border: 1px dashed #d1d5db;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.delete-btn {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 工具类 */\n.bg-white { background-color: #ffffff; }\n.bg-green-50 { background-color: #ecfdf5; }\n.bg-green-500 { background-color: #4CAF50; }\n.bg-gray-100 { background-color: #f3f4f6; }\n.bg-gray-300 { background-color: #d1d5db; }\n\n.text-white { color: #ffffff; }\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-600 { color: #4b5563; }\n.text-gray-700 { color: #374151; }\n.text-gray-900 { color: #111827; }\n.text-green-500 { color: #4CAF50; }\n\n.text-xs { font-size: 12px; }\n.text-sm { font-size: 14px; }\n.text-lg { font-size: 18px; }\n.text-2xl { font-size: 24px; }\n.font-medium { font-weight: 500; }\n\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.flex-wrap { flex-wrap: wrap; }\n.flex-col { flex-direction: column; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n\n.w-full { width: 100%; }\n.h-full { height: 100%; }\n\n.p-3 { padding: 12px; }\n.p-4 { padding: 16px; }\n.px-3 { padding-left: 12px; padding-right: 12px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-1 { padding-top: 4px; padding-bottom: 4px; }\n.py-2 { padding-top: 8px; padding-bottom: 8px; }\n.pt-10 { padding-top: 40px; }\n.pb-3 { padding-bottom: 12px; }\n\n.m-1 { margin: 4px; }\n.m-2 { margin: 8px; }\n.mx-2 { margin-left: 8px; margin-right: 8px; }\n.mt-1 { margin-top: 4px; }\n.mt-2 { margin-top: 8px; }\n.mt-3 { margin-top: 12px; }\n.mt-4 { margin-top: 16px; }\n.mb-2 { margin-bottom: 8px; }\n.mb-4 { margin-bottom: 16px; }\n.ml-1 { margin-left: 4px; }\n.ml-2 { margin-left: 8px; }\n.mr-2 { margin-right: 8px; }\n\n.border-b { border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #e5e7eb; }\n\n.rounded-lg { border-radius: 8px; }\n.rounded-full { border-radius: 9999px; }\n\n.relative { position: relative; }\n.object-cover { object-fit: cover; }\n\n.block { display: block; }\n\n.back-icon {\n  width: 18px;\n  height: 18px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/community/post-publish.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","createPost","onMounted","MiniProgramPage"],"mappings":"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"}