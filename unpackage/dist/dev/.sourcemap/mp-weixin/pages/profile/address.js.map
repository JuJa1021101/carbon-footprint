{"version":3,"file":"address.js","sources":["pages/profile/address.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9hZGRyZXNzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-green px-4 py-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\">\n          <icon-image name=\"back\" size=\"22\" color=\"#FFFFFF\"></icon-image>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-white text-lg font-medium\">收货地址</text>\n        </view>\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的占位 -->\n      </view>\n    </view>\n    \n    <!-- 无地址提示 -->\n    <view v-if=\"addressList.length === 0\" class=\"empty-address flex flex-col items-center justify-center\">\n      <image src=\"/static/images/empty-address.png\" mode=\"aspectFit\" class=\"empty-image\"></image>\n      <text class=\"text-gray-500 mb-4\">暂无收货地址</text>\n    </view>\n    \n    <!-- 加载中提示 -->\n    <view v-else-if=\"loading\" class=\"loading flex flex-col items-center justify-center\">\n      <view class=\"spinner\"></view>\n      <text class=\"text-gray-500 mt-3\">加载中...</text>\n    </view>\n    \n    <!-- 错误提示 -->\n    <view v-else-if=\"hasError\" class=\"error flex flex-col items-center justify-center\">\n      <text class=\"iconfont icon-warning text-red-500 text-4xl\"></text>\n      <text class=\"text-gray-500 mt-2\">{{errorMessage || '加载失败'}}</text>\n      <button class=\"retry-btn mt-4\" @tap=\"loadAddressList\">重新加载</button>\n    </view>\n    \n    <!-- 地址列表 -->\n    <view v-else class=\"address-list\">\n      <view \n        v-for=\"(item, index) in addressList\" \n        :key=\"index\" \n        class=\"address-card mb-3 bg-white\"\n      >\n        <view class=\"p-4\">\n          <view class=\"flex justify-between mb-2\">\n            <view class=\"flex\">\n              <text class=\"font-medium\">{{item.name}}</text>\n              <text class=\"ml-2 text-gray-500\">{{item.phone}}</text>\n            </view>\n            <view v-if=\"item.isDefault\" class=\"default-tag\">默认</view>\n          </view>\n          \n          <view class=\"address-location\">\n            <text class=\"text-gray-600\">{{item.region}}</text>\n            <text class=\"text-gray-700 address-detail\">{{item.address}}</text>\n          </view>\n          \n          <view class=\"flex justify-between mt-3 pt-3 border-t border-gray-100\">\n            <view class=\"flex items-center\" @tap=\"toggleDefault(index)\">\n              <view class=\"check-icon-wrapper\">\n                <icon-image v-if=\"item.isDefault\" name=\"check-circle\" size=\"20\" color=\"#4CAF50\"></icon-image>\n                <icon-image v-else name=\"circle\" size=\"20\" color=\"#d1d5db\"></icon-image>\n              </view>\n              <text class=\"text-sm ml-2\">设为默认</text>\n            </view>\n            \n            <view class=\"flex\">\n              <view class=\"address-action flex items-center mr-4\" @tap=\"editAddress(index)\">\n                <icon-image name=\"edit\" size=\"18\" color=\"#6b7280\"></icon-image>\n                <text class=\"text-sm ml-1\">编辑</text>\n              </view>\n              <view class=\"address-action flex items-center\" @tap=\"deleteAddress(index)\">\n                <icon-image name=\"delete\" size=\"18\" color=\"#6b7280\"></icon-image>\n                <text class=\"text-sm ml-1\">删除</text>\n              </view>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 添加新地址按钮 -->\n    <view class=\"fixed-bottom\">\n      <view class=\"p-4\">\n        <button class=\"w-full py-3 rounded-full bg-green text-white\" @tap=\"navigateToAddAddress\">+ 新增收货地址</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { getAddressList, saveAddress, deleteAddress as deleteAddressService } from '../../services/address.js';\nimport IconImage from '../../components/IconImage.vue';\n\n// 地址列表数据\nconst addressList = ref([]);\nconst loading = ref(false);\nconst hasError = ref(false);\nconst errorMessage = ref('');\n\n// 加载地址列表\nconst loadAddressList = async () => {\n  loading.value = true;\n  hasError.value = false;\n  \n  console.log('开始加载地址列表');\n  \n  try {\n    const addresses = await getAddressList();\n    console.log('获取到地址列表:', addresses);\n    addressList.value = addresses;\n    \n    if (addresses.length === 0) {\n      console.log('地址列表为空');\n    }\n  } catch (error) {\n    console.error('加载地址列表失败:', error);\n    hasError.value = true;\n    errorMessage.value = error.message || '加载地址列表失败';\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 设置默认地址\nconst toggleDefault = async (index) => {\n  if (addressList.value[index].isDefault) {\n    return; // 已经是默认地址，不做操作\n  }\n  \n  try {\n    uni.showLoading({ title: '设置中...' });\n    \n    const address = { ...addressList.value[index] };\n    address.isDefault = true;\n    \n    // 使用服务设置默认地址\n    await saveAddress(address, true);\n    \n    // 更新本地地址列表\n    addressList.value.forEach((item, i) => {\n      item.isDefault = i === index;\n    });\n    \n    uni.hideLoading();\n    uni.showToast({\n      title: '设置默认地址成功',\n      icon: 'success'\n    });\n  } catch (error) {\n    uni.hideLoading();\n    console.error('设置默认地址失败:', error);\n    uni.showToast({\n      title: '设置失败，请稍后重试',\n      icon: 'none'\n    });\n  }\n};\n\n// 编辑地址\nconst editAddress = (index) => {\n  // 确保有地址数据\n  if (!addressList.value[index]) {\n    console.error('没有找到地址数据:', index);\n    uni.showToast({\n      title: '地址数据不存在',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  // 打印原始地址数据\n  console.log('原始地址数据:', addressList.value[index]);\n  \n  // 将地址信息传递到编辑页面\n  const addressData = {\n    _id: addressList.value[index]._id,\n    name: addressList.value[index].name,\n    receiver: addressList.value[index].name,\n    phone: addressList.value[index].phone,\n    address: addressList.value[index].address,\n    addall: addressList.value[index].address,\n    region: addressList.value[index].region,\n    add: addressList.value[index].region,\n    isDefault: addressList.value[index].isDefault\n  };\n  \n  // 使用本地存储传递数据\n  uni.setStorageSync('edit_address_data', addressData);\n  \n  console.log('已将地址信息保存到本地存储:', addressData);\n  \n  // 简单地传递索引\n  uni.navigateTo({\n    url: `/pages/profile/address-edit?index=${index}`\n  });\n};\n\n// 删除地址\nconst deleteAddress = async (index) => {\n  uni.showModal({\n    title: '提示',\n    content: '确认删除该收货地址？',\n    success: async (res) => {\n      if (res.confirm) {\n        try {\n          uni.showLoading({ title: '删除中...' });\n          \n          const addressId = addressList.value[index]._id;\n          await deleteAddressService(addressId);\n          \n          // 从本地列表中移除\n          addressList.value.splice(index, 1);\n          \n          uni.hideLoading();\n          uni.showToast({\n            title: '删除成功',\n            icon: 'success'\n          });\n        } catch (error) {\n          uni.hideLoading();\n          console.error('删除地址失败:', error);\n          uni.showToast({\n            title: '删除失败，请稍后重试',\n            icon: 'none'\n          });\n        }\n      }\n    }\n  });\n};\n\n// 跳转到添加地址页面\nconst navigateToAddAddress = () => {\n  uni.navigateTo({\n    url: '/pages/profile/address-edit'\n  });\n};\n\n// 监听地址更新事件\nuni.$on('addressUpdated', () => {\n  console.log('收到地址更新事件，重新加载地址列表');\n  loadAddressList();\n});\n\nonMounted(() => {\n  console.log('地址管理页面加载');\n  loadAddressList();\n  \n  // 返回清理事件监听\n  return () => {\n    uni.$off('addressUpdated');\n  };\n});\n</script>\n\n<style>\n.container {\n  background-color: #f8f9fa;\n  min-height: 100vh;\n  padding-bottom: 80px;\n}\n\n.header {\n  padding-top: 44px;\n  padding-bottom: 12px;\n  box-sizing: content-box;\n}\n\n.bg-green {\n  background-color: #4CAF50;\n}\n\n.w-24px {\n  width: 24px;\n}\n\n.empty-address {\n  margin-top: 120px;\n}\n\n.empty-image {\n  width: 100px;\n  height: 100px;\n  margin-bottom: 20px;\n}\n\n.address-list {\n  padding: 16px;\n}\n\n.address-card {\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.address-detail {\n  word-break: break-all;\n  line-height: 1.6;\n  display: -webkit-box;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 2;\n}\n\n.default-tag {\n  background-color: #fff5e5;\n  color: #ff9800;\n  font-size: 12px;\n  padding: 2px 6px;\n  border-radius: 4px;\n}\n\n.check-icon-wrapper {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.address-action {\n  color: #6b7280;\n}\n\n.fixed-bottom {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: #ffffff;\n  border-top: 1px solid #f0f0f0;\n}\n\n.bg-white { background-color: #ffffff; }\n.text-white { color: #ffffff; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-700 { color: #374151; }\n\n.flex { display: flex; }\n.flex-col { flex-direction: column; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-between { justify-content: space-between; }\n.justify-center { justify-content: center; }\n.text-center { text-align: center; }\n\n.p-4 { padding: 16px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n.pt-3 { padding-top: 12px; }\n\n.mb-4 { margin-bottom: 16px; }\n.mb-3 { margin-bottom: 12px; }\n.mb-2 { margin-bottom: 8px; }\n.mt-3 { margin-top: 12px; }\n.ml-2 { margin-left: 8px; }\n.ml-1 { margin-left: 4px; }\n.mr-4 { margin-right: 16px; }\n\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.text-xs { font-size: 12px; }\n.font-medium { font-weight: 500; }\n\n.rounded-full { border-radius: 9999px; }\n.w-full { width: 100%; }\n.border-t { border-top-width: 1px; }\n.border-gray-100 { border-color: #f0f0f0; }\n\n.loading {\n  margin-top: 120px;\n}\n\n.spinner {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  border: 3px solid rgba(76, 175, 80, 0.2);\n  border-top-color: #4CAF50;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n.error {\n  margin-top: 120px;\n}\n\n.retry-btn {\n  background-color: #4CAF50;\n  color: white;\n  padding: 8px 16px;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.address-location {\n  display: flex;\n  flex-direction: column;\n  margin-bottom: 8px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/profile/address.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","getAddressList","saveAddress","deleteAddressService","onMounted","MiniProgramPage"],"mappings":"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"}