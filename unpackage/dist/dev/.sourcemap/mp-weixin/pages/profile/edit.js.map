{"version":3,"file":"edit.js","sources":["pages/profile/edit.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-green px-4 py-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\">\n          <icon-image name=\"back\" size=\"22\" color=\"#FFFFFF\"></icon-image>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-white text-lg font-medium\">个人信息</text>\n        </view>\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的占位 -->\n      </view>\n    </view>\n    \n    <!-- 头像选择 -->\n    <view class=\"bg-white p-4 mb-2\">\n      <view class=\"flex items-center justify-between\">\n        <text class=\"text-gray-700\">头像</text>\n        <view class=\"flex items-center\" @tap=\"chooseAvatar\">\n          <image :src=\"userInfo.avatar\" class=\"avatar-medium\"></image>\n          <text class=\"text-xs text-gray-400 ml-2\">点击修改头像</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 基本信息 -->\n    <view class=\"bg-white mb-2\">\n      <!-- 昵称 -->\n      <view class=\"p-4 border-b border-gray-100\">\n        <view class=\"flex items-center justify-between\">\n          <text class=\"text-gray-700\">昵称</text>\n          <view class=\"flex items-center\">\n            <input type=\"text\" v-model=\"userInfo.nickname\" placeholder=\"请输入昵称\" class=\"text-right text-gray-700 pr-2\" />\n          </view>\n        </view>\n      </view>\n      \n      <!-- 账号 -->\n      <view class=\"p-4 border-b border-gray-100\">\n        <view class=\"flex items-center justify-between\">\n          <text class=\"text-gray-700\">账号</text>\n          <view class=\"flex items-center\">\n            <text class=\"text-gray-500\">{{userInfo.account}}</text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 性别 -->\n      <view class=\"p-4 border-b border-gray-100\">\n        <view class=\"flex items-center justify-between\">\n          <text class=\"text-gray-700\">性别</text>\n          <view class=\"flex items-center\">\n            <radio-group @change=\"genderChange\">\n              <label class=\"radio-label mr-4\">\n                <radio value=\"男\" :checked=\"userInfo.gender === '男'\" color=\"#4CAF50\" />\n                <text class=\"ml-1\">男</text>\n              </label>\n              <label class=\"radio-label\">\n                <radio value=\"女\" :checked=\"userInfo.gender === '女'\" color=\"#4CAF50\" />\n                <text class=\"ml-1\">女</text>\n              </label>\n            </radio-group>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 出生日期 -->\n      <view class=\"p-4 border-b border-gray-100\">\n        <view class=\"flex items-center justify-between\">\n          <text class=\"text-gray-700\">出生日期</text>\n          <picker mode=\"date\" :value=\"userInfo.birthdate\" @change=\"birthdateChange\" fields=\"day\" start=\"1900-01-01\" end=\"2023-12-31\">\n            <view class=\"flex items-center\">\n              <text class=\"text-gray-500 mr-2\">{{userInfo.birthdate || '请选择'}}</text>\n              <icon-image name=\"right\" size=\"18\"></icon-image>\n            </view>\n          </picker>\n        </view>\n      </view>\n      \n      <!-- 城市 -->\n      <view class=\"p-4 border-b border-gray-100\">\n        <view class=\"flex items-center justify-between\">\n          <text class=\"text-gray-700\">所在城市</text>\n          <picker mode=\"region\" :value=\"cityArray\" @change=\"cityChange\">\n            <view class=\"flex items-center\">\n              <text class=\"text-gray-500 mr-2\">{{userInfo.city || '请选择'}}</text>\n              <icon-image name=\"right\" size=\"18\"></icon-image>\n            </view>\n          </picker>\n        </view>\n      </view>\n      \n      <!-- 职业 -->\n      <view class=\"p-4\">\n        <view class=\"flex items-center justify-between\">\n          <text class=\"text-gray-700\">职业</text>\n          <view class=\"flex items-center\">\n            <input type=\"text\" v-model=\"userInfo.occupation\" placeholder=\"请输入职业\" class=\"text-right text-gray-700 pr-2\" />\n          </view>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 保存按钮 -->\n    <view class=\"p-4\">\n      <button class=\"bg-green text-white py-3 rounded-full w-full\" @tap=\"saveUserInfo\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport IconImage from '../../components/IconImage.vue';\n\n// 用户信息数据\nconst userInfo = reactive({\n  avatar: '/static/images/user-avatar.jpg',\n  nickname: '绿色先锋',\n  account: 'Dawn99',\n  gender: '男',\n  birthdate: '1992-07-11',\n  city: '广东省 广州市 天河区',\n  occupation: '能源顾问'\n});\n\n// 城市数组，用于城市选择器\nconst cityArray = ref(['广东省', '广州市', '天河区']);\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 选择头像\nconst chooseAvatar = () => {\n  uni.chooseImage({\n    count: 1, // 默认9\n    sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有\n    sourceType: ['album', 'camera'], // 从相册选择或拍照\n    success: (res) => {\n      // 返回选定照片的临时文件路径\n      const tempFilePath = res.tempFilePaths[0];\n      \n      // 上传图片到云存储\n      uploadFile(tempFilePath);\n    }\n  });\n};\n\n// 上传图片到云存储\nconst uploadFile = (filePath) => {\n  uni.showLoading({ title: '上传中...' });\n  \n  const extName = filePath.substring(filePath.lastIndexOf('.') + 1);\n  const cloudPath = `avatar/${Date.now()}-${Math.random().toString(36).slice(-8)}.${extName}`;\n  \n  uniCloud.uploadFile({\n    filePath: filePath,\n    cloudPath: cloudPath,\n    success: (res) => {\n      userInfo.avatar = res.fileID;\n      uni.hideLoading();\n      uni.showToast({ title: '上传成功', icon: 'success' });\n    },\n    fail: (err) => {\n      uni.hideLoading();\n      uni.showToast({ title: '上传失败', icon: 'error' });\n      console.error(err);\n    }\n  });\n};\n\n// 性别改变事件\nconst genderChange = (e) => {\n  userInfo.gender = e.detail.value;\n};\n\n// 出生日期改变事件\nconst birthdateChange = (e) => {\n  userInfo.birthdate = e.detail.value;\n};\n\n// 城市改变事件\nconst cityChange = (e) => {\n  const cityArr = e.detail.value;\n  cityArray.value = cityArr;\n  userInfo.city = cityArr.join(' ');\n};\n\n// 保存用户信息\nconst saveUserInfo = () => {\n  // 表单验证\n  if (!userInfo.nickname) {\n    return uni.showToast({ title: '请输入昵称', icon: 'none' });\n  }\n  \n  uni.showLoading({ title: '保存中...' });\n  \n  // 处理日期格式，转换为Date对象\n  const birthdate = userInfo.birthdate ? new Date(userInfo.birthdate) : null;\n  \n  // 通过云函数调用保存用户信息\n  uniCloud.callFunction({\n    name: 'saveUserInfo',\n    data: {\n      account: userInfo.account,\n      nickname: userInfo.nickname,\n      gender: userInfo.gender,\n      birthdate: birthdate,\n      city: userInfo.city,\n      occupation: userInfo.occupation,\n      avatar: userInfo.avatar\n    }\n  }).then(res => {\n    if (res.result && res.result.code === 0) {\n      uni.hideLoading();\n      uni.showToast({\n        title: '保存成功',\n        icon: 'success',\n        success: () => {\n          // 信息保存到本地\n          uni.setStorageSync('userInfo', JSON.stringify(userInfo));\n          \n          // 触发全局事件，通知其他页面用户信息更新\n          uni.$emit('userInfoUpdated', userInfo);\n          \n          // 返回个人中心\n          setTimeout(() => {\n            uni.navigateBack();\n          }, 1000);\n        }\n      });\n    } else {\n      throw new Error(res.result.msg || '保存失败');\n    }\n  }).catch(err => {\n    uni.hideLoading();\n    uni.showToast({\n      title: err.message || '保存失败',\n      icon: 'error'\n    });\n    console.error('保存用户信息失败：', err);\n  });\n};\n\n// 页面加载时获取用户信息\nonMounted(() => {\n  // 尝试从本地获取用户信息\n  const localUserInfo = uni.getStorageSync('userInfo');\n  if (localUserInfo) {\n    try {\n      const parsedInfo = JSON.parse(localUserInfo);\n      Object.assign(userInfo, parsedInfo);\n      \n      // 设置城市数组\n      if (userInfo.city) {\n        cityArray.value = userInfo.city.split(' ');\n      }\n    } catch (e) {\n      console.error('解析本地用户信息失败', e);\n    }\n  } else {\n    // 从数据库获取\n    // 使用云函数获取用户信息\n    uniCloud.callFunction({\n      name: 'getProfile',\n      data: { account: userInfo.account }\n    }).then(res => {\n      if (res.result && res.result.code === 0 && res.result.data.userInfo) {\n        const dbUserInfo = res.result.data.userInfo;\n        \n        // 更新本地用户信息\n        userInfo.nickname = dbUserInfo.nickname || userInfo.nickname;\n        userInfo.gender = dbUserInfo.gender || userInfo.gender;\n        \n        // 处理日期类型\n        if (dbUserInfo.birthdate) {\n          const date = new Date(dbUserInfo.birthdate);\n          if (!isNaN(date.getTime())) {\n            const year = date.getFullYear();\n            const month = String(date.getMonth() + 1).padStart(2, '0');\n            const day = String(date.getDate()).padStart(2, '0');\n            userInfo.birthdate = `${year}-${month}-${day}`;\n          }\n        }\n        \n        userInfo.city = dbUserInfo.city || userInfo.city;\n        userInfo.occupation = dbUserInfo.occupation || userInfo.occupation;\n        userInfo.avatar = dbUserInfo.avatar || userInfo.avatar;\n        \n        // 设置城市数组\n        if (userInfo.city) {\n          cityArray.value = userInfo.city.split(' ');\n        }\n      }\n    }).catch(err => {\n      console.error('获取用户信息失败', err);\n    });\n  }\n});\n</script>\n\n<style>\n.container {\n  background-color: #f8f9fa;\n  min-height: 100vh;\n}\n\n.header {\n  padding-top: 44px;\n  padding-bottom: 12px;\n  box-sizing: content-box;\n}\n\n.bg-green {\n  background-color: #4CAF50;\n}\n\n.text-green-500 {\n  color: #4CAF50;\n}\n\n.w-24px {\n  width: 24px;\n}\n\n.avatar-medium {\n  width: 50px;\n  height: 50px;\n  border-radius: 50%;\n}\n\n.border-b {\n  border-bottom-width: 1px;\n}\n\n.border-gray-100 {\n  border-color: #f0f0f0;\n}\n\n.rounded-full {\n  border-radius: 9999px;\n}\n\n.radio-label {\n  display: inline-flex;\n  align-items: center;\n}\n\n.bg-white { background-color: #ffffff; }\n.text-white { color: #ffffff; }\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-700 { color: #374151; }\n\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-between { justify-content: space-between; }\n.justify-center { justify-content: center; }\n.text-center { text-align: center; }\n.text-right { text-align: right; }\n\n.p-4 { padding: 16px; }\n.p-3 { padding: 12px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-4 { padding-top: 16px; padding-bottom: 16px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n.py-2 { padding-top: 8px; padding-bottom: 8px; }\n.pr-2 { padding-right: 8px; }\n\n.mb-2 { margin-bottom: 8px; }\n.mr-4 { margin-right: 16px; }\n.mr-2 { margin-right: 8px; }\n.ml-2 { margin-left: 8px; }\n.ml-1 { margin-left: 4px; }\n\n.text-lg { font-size: 18px; }\n.text-xs { font-size: 12px; }\n.font-medium { font-weight: 500; }\n\ninput {\n  outline: none;\n  border: none;\n  width: 150px;\n}\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/profile/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","uniCloud","onMounted","MiniProgramPage"],"mappings":"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"}