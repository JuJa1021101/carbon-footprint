{"version":3,"file":"reset-points.js","sources":["pages/profile/reset-points.vue","../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9yZXNldC1wb2ludHMudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header bg-white px-4 pt-10 pb-3\">\n      <view class=\"flex items-center\">\n        <view @tap=\"goBack\">\n          <text class=\"iconfont icon-left text-gray-600 text-lg\"></text>\n        </view>\n        <view class=\"flex-1 text-center\">\n          <text class=\"text-gray-900 text-lg font-medium\">积分系统重置</text>\n        </view>\n        <view class=\"w-24px\"></view> <!-- 为了居中标题的占位 -->\n      </view>\n    </view>\n    \n    <!-- 内容区 -->\n    <view class=\"p-4\">\n      <view class=\"card bg-white rounded-lg shadow-sm p-4\">\n        <view class=\"mb-4\">\n          <text class=\"text-lg font-medium mb-2 block\">重置积分系统</text>\n          <text class=\"text-gray-600 text-sm\">此操作将删除所有积分记录，并创建一个统一的默认用户积分记录。请谨慎操作！</text>\n        </view>\n        \n        <view class=\"mb-4\">\n          <text class=\"text-gray-600 text-sm\">当前积分: {{ currentPoints }}</text>\n        </view>\n        \n        <view class=\"flex justify-center\">\n          <button \n            class=\"bg-red-500 text-white px-4 py-2 rounded-lg\" \n            @tap=\"confirmReset\"\n            :disabled=\"isResetting\">\n            {{ isResetting ? '重置中...' : '重置积分系统' }}\n          </button>\n        </view>\n      </view>\n      \n      <view class=\"mt-4 card bg-white rounded-lg shadow-sm p-4\">\n        <view class=\"mb-4\">\n          <text class=\"text-lg font-medium mb-2 block\">刷新积分</text>\n          <text class=\"text-gray-600 text-sm\">从云端获取最新积分数据</text>\n        </view>\n        \n        <view class=\"flex justify-center\">\n          <button \n            class=\"bg-green-500 text-white px-4 py-2 rounded-lg\" \n            @tap=\"refreshPoints\"\n            :disabled=\"isRefreshing\">\n            {{ isRefreshing ? '刷新中...' : '刷新积分' }}\n          </button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { getUserPoints } from '../../services/points.js';\n\nconst currentPoints = ref(0);\nconst isResetting = ref(false);\nconst isRefreshing = ref(false);\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 加载当前积分\nconst loadPoints = async (force = false) => {\n  isRefreshing.value = true;\n  try {\n    const result = await getUserPoints(force);\n    if (result && result.success) {\n      currentPoints.value = result.data.points;\n      console.log('当前积分:', currentPoints.value);\n    }\n  } catch (error) {\n    console.error('获取积分失败:', error);\n  } finally {\n    isRefreshing.value = false;\n  }\n};\n\n// 刷新积分\nconst refreshPoints = async () => {\n  await loadPoints(true);\n  \n  uni.showToast({\n    title: '积分已刷新',\n    icon: 'success'\n  });\n};\n\n// 确认重置\nconst confirmReset = () => {\n  uni.showModal({\n    title: '确认重置',\n    content: '此操作将删除所有积分记录，并创建一个新的默认积分记录。是否继续？',\n    success: (res) => {\n      if (res.confirm) {\n        resetPointsSystem();\n      }\n    }\n  });\n};\n\n// 重置积分系统\nconst resetPointsSystem = async () => {\n  isResetting.value = true;\n  \n  try {\n    uni.showLoading({ title: '重置中...' });\n    \n    const { result } = await uniCloud.callFunction({\n      name: 'resetPointsSystem'\n    });\n    \n    uni.hideLoading();\n    \n    if (result && result.success) {\n      uni.showToast({\n        title: '重置成功',\n        icon: 'success'\n      });\n      \n      // 刷新积分\n      await loadPoints(true);\n      \n      // 通知积分更新\n      uni.$emit('userPointsUpdated', { points: currentPoints.value });\n    } else {\n      uni.showToast({\n        title: '重置失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('重置积分系统失败:', error);\n    uni.hideLoading();\n    uni.showToast({\n      title: '重置失败',\n      icon: 'none'\n    });\n  } finally {\n    isResetting.value = false;\n  }\n};\n\n// 页面加载\nonMounted(async () => {\n  await loadPoints();\n});\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f8f9fa;\n}\n\n.header {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n\n.card {\n  overflow: hidden;\n}\n\n/* 工具类 */\n.bg-white { background-color: #ffffff; }\n.bg-red-500 { background-color: #ef4444; }\n.bg-green-500 { background-color: #10b981; }\n.text-white { color: #ffffff; }\n.text-gray-600 { color: #4b5563; }\n.text-gray-900 { color: #111827; }\n.text-lg { font-size: 18px; }\n.text-sm { font-size: 14px; }\n.font-medium { font-weight: 500; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-2 { padding-top: 8px; padding-bottom: 8px; }\n.pt-10 { padding-top: 40px; }\n.pb-3 { padding-bottom: 12px; }\n.p-4 { padding: 16px; }\n.mb-4 { margin-bottom: 16px; }\n.mb-2 { margin-bottom: 8px; }\n.mt-4 { margin-top: 16px; }\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.items-center { align-items: center; }\n.justify-center { justify-content: center; }\n.rounded-lg { border-radius: 8px; }\n.shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }\n.block { display: block; }\n.w-24px { width: 24px; }\n</style> ","import MiniProgramPage from 'D:/Documents/HBuilderProjects/CarbonFootprint/pages/profile/reset-points.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","getUserPoints","uniCloud","onMounted","MiniProgramPage"],"mappings":";;;;;;AA4DA,UAAM,gBAAgBA,cAAAA,IAAI,CAAC;AAC3B,UAAM,cAAcA,cAAAA,IAAI,KAAK;AAC7B,UAAM,eAAeA,cAAAA,IAAI,KAAK;AAG9B,UAAM,SAAS,MAAM;AACnBC,oBAAG,MAAC,aAAY;AAAA,IAClB;AAGA,UAAM,aAAa,OAAO,QAAQ,UAAU;AAC1C,mBAAa,QAAQ;AACrB,UAAI;AACF,cAAM,SAAS,MAAMC,8BAAc,KAAK;AACxC,YAAI,UAAU,OAAO,SAAS;AAC5B,wBAAc,QAAQ,OAAO,KAAK;AAClCD,wBAAY,MAAA,MAAA,OAAA,wCAAA,SAAS,cAAc,KAAK;AAAA,QACzC;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,wCAAc,WAAW,KAAK;AAAA,MAClC,UAAY;AACR,qBAAa,QAAQ;AAAA,MACtB;AAAA,IACH;AAGA,UAAM,gBAAgB,YAAY;AAChC,YAAM,WAAW,IAAI;AAErBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACV,CAAG;AAAA,IACH;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACf;UACD;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,oBAAoB,YAAY;AACpC,kBAAY,QAAQ;AAEpB,UAAI;AACFA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAEnC,cAAM,EAAE,OAAM,IAAK,MAAME,cAAAA,GAAS,aAAa;AAAA,UAC7C,MAAM;AAAA,QACZ,CAAK;AAEDF,sBAAG,MAAC,YAAW;AAEf,YAAI,UAAU,OAAO,SAAS;AAC5BA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAGD,gBAAM,WAAW,IAAI;AAGrBA,wBAAG,MAAC,MAAM,qBAAqB,EAAE,QAAQ,cAAc,MAAK,CAAE;AAAA,QACpE,OAAW;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,yCAAc,aAAa,KAAK;AAChCA,sBAAG,MAAC,YAAW;AACfA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACL,UAAY;AACR,oBAAY,QAAQ;AAAA,MACrB;AAAA,IACH;AAGAG,kBAAAA,UAAU,YAAY;AACpB,YAAM,WAAU;AAAA,IAClB,CAAC;;;;;;;;;;;;;;;ACxJD,GAAG,WAAWC,SAAe;"}