{"version":3,"file":"address.js","sources":["services/address.js"],"sourcesContent":["/**\n * 地址管理服务\n */\nimport { getCurrentUserFromProfile } from './login.js';\n\n/**\n * 获取用户地址列表\n * @returns {Promise} 地址列表Promise\n */\nexport const getAddressList = () => {\n  return new Promise((resolve, reject) => {\n    // 获取当前用户ID\n    const currentUser = getCurrentUserFromProfile();\n    const userId = currentUser && currentUser._id ? currentUser._id : null;\n    \n    console.log('获取地址列表，用户ID:', userId);\n    \n    // 调用云函数获取地址列表\n    uniCloud.callFunction({\n      name: 'getAddresses',\n      data: {\n        userId\n      }\n    }).then(res => {\n      console.log('getAddresses云函数返回结果:', res.result);\n      \n      if (res.result && res.result.success) {\n        // 处理地址数据，确保字段名一致\n        const addresses = res.result.data.map(addr => ({\n          _id: addr._id,\n          name: addr.name || addr.receiver || '',\n          phone: addr.phone || '',\n          address: addr.address || addr.addall || '',\n          region: addr.region || addr.add || '',\n          isDefault: addr.is_default || addr.isDefault || false\n        }));\n        \n        console.log('处理后的地址列表:', addresses);\n        resolve(addresses);\n      } else {\n        console.error('获取地址列表失败:', res.result?.message || '未知错误');\n        reject(new Error(res.result?.message || '获取地址列表失败'));\n      }\n    }).catch(err => {\n      console.error('获取地址列表失败:', err);\n      reject(err);\n    });\n  });\n};\n\n/**\n * 保存地址\n * @param {Object} address 地址信息\n * @param {Boolean} isEdit 是否为编辑模式\n * @returns {Promise} 保存结果Promise\n */\nexport const saveAddress = (address, isEdit = false) => {\n  return new Promise((resolve, reject) => {\n    // 获取当前用户ID\n    const currentUser = getCurrentUserFromProfile();\n    const userId = currentUser && currentUser._id ? currentUser._id : null;\n    \n    console.log('保存地址，用户ID:', userId);\n    console.log('保存地址内容:', address);\n    \n    // 构建要保存的地址数据\n    const addressData = {\n      _id: isEdit ? address._id : undefined,\n      receiver: address.receiver || address.name || '',\n      phone: address.phone || '',\n      add: address.add || address.region || '',\n      addall: address.addall || address.address || '',\n      isDefault: address.isDefault || false\n    };\n    \n    console.log('处理后的地址数据:', addressData);\n    \n    // 调用云函数保存地址\n    uniCloud.callFunction({\n      name: 'saveAddress',\n      data: {\n        userId,\n        address: addressData,\n        isEdit\n      }\n    }).then(res => {\n      console.log('saveAddress云函数返回结果:', res.result);\n      \n      if (res.result && res.result.success) {\n        resolve(res.result);\n      } else {\n        console.error('保存地址失败:', res.result?.message || '未知错误');\n        reject(new Error(res.result?.message || '保存地址失败'));\n      }\n    }).catch(err => {\n      console.error('保存地址失败:', err);\n      reject(err);\n    });\n  });\n};\n\n/**\n * 删除地址\n * @param {String} addressId 地址ID\n * @returns {Promise} 删除结果Promise\n */\nexport const deleteAddress = (addressId) => {\n  return new Promise((resolve, reject) => {\n    // 获取当前用户ID\n    const currentUser = getCurrentUserFromProfile();\n    const userId = currentUser && currentUser._id ? currentUser._id : null;\n    \n    console.log('删除地址，地址ID:', addressId);\n    \n    // 调用云函数删除地址\n    uniCloud.callFunction({\n      name: 'deleteAddress',\n      data: {\n        userId,\n        addressId\n      }\n    }).then(res => {\n      console.log('deleteAddress云函数返回结果:', res.result);\n      \n      if (res.result && res.result.success) {\n        resolve(res.result);\n      } else {\n        console.error('删除地址失败:', res.result?.message || '未知错误');\n        reject(new Error(res.result?.message || '删除地址失败'));\n      }\n    }).catch(err => {\n      console.error('删除地址失败:', err);\n      reject(err);\n    });\n  });\n};"],"names":["getCurrentUserFromProfile","uni","uniCloud"],"mappings":"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"}