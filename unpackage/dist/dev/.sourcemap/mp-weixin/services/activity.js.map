{"version":3,"file":"activity.js","sources":["services/activity.js"],"sourcesContent":["/**\n * 活动管理相关服务\n */\n\n/**\n * 获取所有活动列表\n * @returns {Promise} 包含活动列表数据的Promise\n */\nexport const getActivities = () => {\n  return new Promise((resolve, reject) => {\n    uni.showLoading({ title: '加载中...' });\n    \n    uniCloud.callFunction({\n      name: 'getActivities',\n    }).then(res => {\n      uni.hideLoading();\n      if (res.result.code === 0) {\n        resolve(res.result.data);\n      } else {\n        reject(new Error(res.result.message || '获取活动列表失败'));\n      }\n    }).catch(err => {\n      uni.hideLoading();\n      reject(new Error(err.message || '获取活动列表失败'));\n    });\n  });\n};\n\n/**\n * 获取活动总数\n * @returns {Promise} 包含活动总数的Promise\n */\nexport const getActivityCount = () => {\n  return new Promise((resolve, reject) => {\n    uniCloud.callFunction({\n      name: 'getActivities',\n      data: { count_only: true }\n    }).then(res => {\n      if (res.result.code === 0) {\n        resolve(res.result.data.total);\n      } else {\n        reject(new Error(res.result.message || '获取活动数量失败'));\n      }\n    }).catch(err => {\n      reject(new Error(err.message || '获取活动数量失败'));\n    });\n  });\n};\n\n/**\n * 添加活动\n * @param {Object} activityData 活动数据\n * @returns {Promise} 添加结果Promise\n */\nexport const addActivity = (activityData) => {\n  return new Promise((resolve, reject) => {\n    // 检查管理员登录状态\n    const adminLoginStatus = uni.getStorageSync('admin_login_status');\n    if (adminLoginStatus !== 'loggedin') {\n      reject(new Error('管理员未登录'));\n      return;\n    }\n    \n    // 获取管理员ID\n    const adminId = uni.getStorageSync('admin_id') || 'admin';\n    \n    // 显示加载状态\n    uni.showLoading({ title: '添加中...' });\n    \n    // 调用云函数添加活动\n    uniCloud.callFunction({\n      name: 'addActivity',\n      data: {\n        ...activityData,\n        created_by: adminId\n      }\n    }).then(res => {\n      uni.hideLoading();\n      if (res.result.code === 0) {\n        resolve(res.result.data);\n      } else {\n        reject(new Error(res.result.message || '添加活动失败'));\n      }\n    }).catch(err => {\n      uni.hideLoading();\n      reject(new Error(err.message || '添加活动失败'));\n    });\n  });\n};\n\n/**\n * 更新活动\n * @param {Object} activityData 活动数据\n * @returns {Promise} 更新结果Promise\n */\nexport const updateActivity = (activityData) => {\n  return new Promise((resolve, reject) => {\n    // 检查管理员登录状态\n    const adminLoginStatus = uni.getStorageSync('admin_login_status');\n    if (adminLoginStatus !== 'loggedin') {\n      reject(new Error('管理员未登录'));\n      return;\n    }\n    \n    // 显示加载状态\n    uni.showLoading({ title: '更新中...' });\n    \n    // 调用云函数更新活动\n    uniCloud.callFunction({\n      name: 'updateActivity',\n      data: activityData\n    }).then(res => {\n      uni.hideLoading();\n      if (res.result.code === 0) {\n        resolve(res.result.data);\n      } else {\n        reject(new Error(res.result.message || '更新活动失败'));\n      }\n    }).catch(err => {\n      uni.hideLoading();\n      reject(new Error(err.message || '更新活动失败'));\n    });\n  });\n};\n\n/**\n * 删除活动\n * @param {String} activityId 活动ID\n * @returns {Promise} 删除结果Promise\n */\nexport const deleteActivity = (activityId) => {\n  return new Promise((resolve, reject) => {\n    // 检查管理员登录状态\n    const adminLoginStatus = uni.getStorageSync('admin_login_status');\n    if (adminLoginStatus !== 'loggedin') {\n      reject(new Error('管理员未登录'));\n      return;\n    }\n    \n    // 显示加载状态\n    uni.showLoading({ title: '删除中...' });\n    \n    // 调用云函数删除活动\n    uniCloud.callFunction({\n      name: 'deleteActivity',\n      data: { _id: activityId }\n    }).then(res => {\n      uni.hideLoading();\n      if (res.result.code === 0) {\n        resolve(res.result.data);\n      } else {\n        reject(new Error(res.result.message || '删除活动失败'));\n      }\n    }).catch(err => {\n      uni.hideLoading();\n      reject(new Error(err.message || '删除活动失败'));\n    });\n  });\n}; "],"names":["uni","uniCloud"],"mappings":"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"}