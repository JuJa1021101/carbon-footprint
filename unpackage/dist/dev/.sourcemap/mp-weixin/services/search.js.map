{"version":3,"file":"search.js","sources":["services/search.js"],"sourcesContent":["/**\n * 搜索服务\n */\n\n/**\n * 搜索内容（环保知识和活动）\n * @param {string} keyword 搜索关键词\n * @param {Object} options 查询参数\n * @returns {Promise} 搜索结果Promise\n */\nexport const searchContent = (keyword, options = {}) => {\n  return new Promise((resolve, reject) => {\n    const { page = 1, pageSize = 10 } = options;\n    \n    // 如果搜索关键词为空，返回空结果\n    if (!keyword || keyword.trim() === '') {\n      resolve({\n        results: [],\n        total: 0,\n        page,\n        pageSize\n      });\n      return;\n    }\n    \n    uni.showLoading({ title: '搜索中...' });\n    \n    // 调用云函数搜索内容\n    uniCloud.callFunction({\n      name: 'searchContent',\n      data: {\n        keyword,\n        page,\n        pageSize\n      }\n    }).then(res => {\n      uni.hideLoading();\n      \n      if (res.result.code === 0) {\n        resolve(res.result.data);\n      } else {\n        reject(new Error(res.result.message || '搜索失败'));\n      }\n    }).catch(err => {\n      uni.hideLoading();\n      console.error('搜索失败', err);\n      reject(new Error(err.message || '搜索失败'));\n      \n      // 使用模拟数据作为备用\n      const mockResults = getMockSearchResults(keyword);\n      resolve(mockResults);\n    });\n  });\n};\n\n/**\n * 生成模拟搜索结果（备用数据）\n * @param {string} keyword 搜索关键词\n * @returns {Object} 模拟搜索结果\n */\nconst getMockSearchResults = (keyword) => {\n  const mockKnowledge = [\n    {\n      _id: \"k1\",\n      title: \"垃圾分类指南：一文看懂四分法\",\n      content: \"垃圾分类是指按一定规定或标准将垃圾分类储存、分类投放和分类搬运，从而转变成公共资源的一系列活动的总称。\",\n      tags: \"垃圾分类,环保知识,生活指南\",\n      cover: \"/static/images/userspost/garbage-sorting.jpeg\",\n      views: 1234,\n      likes: 56,\n      createdAt: Date.now() - 3 * 60 * 60 * 1000,\n      type: \"knowledge\",\n      typeText: \"环保知识\"\n    },\n    {\n      _id: \"k2\",\n      title: \"节能减排小窍门：家庭省电技巧\",\n      content: \"日常节电小技巧：1. 及时关闭不用的电器 2. 使用节能灯泡 3. 电器不用时拔掉插头\",\n      tags: \"节能减排,省电技巧,低碳生活\",\n      cover: \"/static/images/userspost/energy-saving.jpeg\",\n      views: 867,\n      likes: 42,\n      createdAt: Date.now() - 24 * 60 * 60 * 1000,\n      type: \"knowledge\",\n      typeText: \"环保知识\"\n    }\n  ];\n  \n  const mockActivities = [\n    {\n      _id: \"a1\",\n      title: \"城市河道清洁志愿行动\",\n      description: \"一起行动，清洁我们的城市河道，保护水资源\",\n      location: \"城东河滨公园\",\n      activity_time: \"6月15日 09:00\",\n      status: \"报名中\",\n      point: 100,\n      createdAt: Date.now() - 2 * 24 * 60 * 60 * 1000,\n      type: \"activity\",\n      typeText: \"环保活动\"\n    },\n    {\n      _id: \"a2\",\n      title: \"废旧电池回收换礼品\",\n      description: \"回收旧电池，保护环境，还能换取环保小礼品\",\n      location: \"市民服务中心\",\n      activity_time: \"6月1日-30日\",\n      status: \"进行中\",\n      point: 50,\n      createdAt: Date.now() - 5 * 24 * 60 * 60 * 1000,\n      type: \"activity\",\n      typeText: \"环保活动\"\n    }\n  ];\n  \n  const keywordLower = keyword.toLowerCase();\n  \n  // 过滤知识\n  const filteredKnowledge = mockKnowledge.filter(item => \n    item.title.toLowerCase().includes(keywordLower) || \n    item.content.toLowerCase().includes(keywordLower) || \n    item.tags.toLowerCase().includes(keywordLower)\n  );\n  \n  // 过滤活动\n  const filteredActivities = mockActivities.filter(item => \n    item.title.toLowerCase().includes(keywordLower) || \n    item.description.toLowerCase().includes(keywordLower) || \n    item.location.toLowerCase().includes(keywordLower)\n  );\n  \n  // 合并结果\n  const results = [...filteredKnowledge, ...filteredActivities];\n  \n  // 按相关性和时间排序\n  results.sort((a, b) => {\n    const aTitleMatch = a.title.toLowerCase().includes(keywordLower);\n    const bTitleMatch = b.title.toLowerCase().includes(keywordLower);\n    \n    if (aTitleMatch && !bTitleMatch) return -1;\n    if (!aTitleMatch && bTitleMatch) return 1;\n    \n    return (b.createdAt || 0) - (a.createdAt || 0);\n  });\n  \n  return {\n    results,\n    total: results.length,\n    page: 1,\n    pageSize: 10\n  };\n}; "],"names":["uni","uniCloud"],"mappings":"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"}